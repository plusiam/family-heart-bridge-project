<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¤ ê°ì • ë‚ ì”¨ ì²´í¬ì¸ - ë‚˜ì˜ ë§ˆìŒ ë‚ ì”¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .title-font {
            font-family: 'Jua', sans-serif;
        }
        
        .weather-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .weather-card:hover {
            transform: translateY(-10px) scale(1.05);
        }
        
        .weather-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.1);
        }
        
        .emotion-bubble {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .emotion-bubble:hover {
            transform: scale(1.15) rotate(5deg);
        }
        
        .emotion-bubble.selected {
            animation: bounce 0.5s infinite alternate;
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3));
        }
        
        @keyframes bounce {
            from { transform: translateY(0px) scale(1.2); }
            to { transform: translateY(-10px) scale(1.2); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            animation: confetti-fall 3s linear;
            z-index: 1000;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .weather-sunny { background: linear-gradient(135deg, #FFD93D 0%, #FFB347 100%); }
        .weather-partly { background: linear-gradient(135deg, #89CFF0 0%, #6CB4EE 100%); }
        .weather-cloudy { background: linear-gradient(135deg, #B0C4DE 0%, #778899 100%); }
        .weather-rainy { background: linear-gradient(135deg, #4682B4 0%, #1E90FF 100%); }
        .weather-stormy { background: linear-gradient(135deg, #483D8B 0%, #2F4F4F 100%); }
        .weather-rainbow { background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 50%, #45B7D1 100%); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
    <!-- í—¤ë” -->
    <header class="glass-effect shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-4xl float-animation">ğŸŒ¤</span>
                    <div>
                        <h1 class="title-font text-2xl md:text-3xl text-gray-800">ê°ì • ë‚ ì”¨ ì²´í¬ì¸</h1>
                        <p class="text-sm text-gray-600">ì˜¤ëŠ˜ ë‚˜ì˜ ë§ˆìŒ ë‚ ì”¨ëŠ” ì–´ë–¤ê°€ìš”?</p>
                    </div>
                </div>
                <button onclick="window.location.href='../../'" class="px-4 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                    ğŸ  ë©”ì¸ìœ¼ë¡œ
                </button>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="flex justify-center mb-8">
            <div class="glass-effect rounded-full p-1 inline-flex">
                <button onclick="showTab('checkin')" id="checkinTab" class="tab-btn px-6 py-2 rounded-full bg-purple-500 text-white transition">
                    âœ¨ ì²´í¬ì¸
                </button>
                <button onclick="showTab('history')" id="historyTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    ğŸ“Š ê¸°ë¡ ë³´ê¸°
                </button>
                <button onclick="showTab('pattern')" id="patternTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    ğŸ“ˆ íŒ¨í„´ ë¶„ì„
                </button>
            </div>
        </div>

        <!-- ì²´í¬ì¸ íƒ­ -->
        <div id="checkinContent" class="tab-content">
            <!-- ë‚ ì§œ í‘œì‹œ -->
            <div class="text-center mb-8">
                <div class="glass-effect rounded-3xl p-6 inline-block">
                    <p class="text-gray-600 mb-2">ì˜¤ëŠ˜ì€</p>
                    <p class="text-3xl font-bold text-gray-800" id="todayDate"></p>
                </div>
            </div>

            <!-- STEP 1: ë‚ ì”¨ ì„ íƒ -->
            <div class="glass-effect rounded-3xl p-8 mb-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">
                    <span class="text-4xl">1ï¸âƒ£</span> ì˜¤ëŠ˜ ë‚˜ì˜ ë§ˆìŒ ë‚ ì”¨ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                </h2>
                
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="weatherCards">
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="sunny">
                        <div class="text-6xl mb-2">â˜€ï¸</div>
                        <h3 class="font-bold text-lg">ë§‘ìŒ</h3>
                        <p class="text-sm text-gray-600 mt-1">ê¸°ë¶„ì´ ì•„ì£¼ ì¢‹ì•„ìš”!</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="partly">
                        <div class="text-6xl mb-2">â›…</div>
                        <h3 class="font-bold text-lg">êµ¬ë¦„ ì¡°ê¸ˆ</h3>
                        <p class="text-sm text-gray-600 mt-1">ëŒ€ì²´ë¡œ ê´œì°®ì•„ìš”</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="cloudy">
                        <div class="text-6xl mb-2">â˜ï¸</div>
                        <h3 class="font-bold text-lg">íë¦¼</h3>
                        <p class="text-sm text-gray-600 mt-1">ê·¸ì € ê·¸ë˜ìš”</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="rainy">
                        <div class="text-6xl mb-2">ğŸŒ§ï¸</div>
                        <h3 class="font-bold text-lg">ë¹„</h3>
                        <p class="text-sm text-gray-600 mt-1">ì¡°ê¸ˆ ìŠ¬í¼ìš”</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="stormy">
                        <div class="text-6xl mb-2">â›ˆï¸</div>
                        <h3 class="font-bold text-lg">í­í’</h3>
                        <p class="text-sm text-gray-600 mt-1">ë§ì´ í˜ë“¤ì–´ìš”</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="rainbow">
                        <div class="text-6xl mb-2">ğŸŒˆ</div>
                        <h3 class="font-bold text-lg">ë¬´ì§€ê°œ</h3>
                        <p class="text-sm text-gray-600 mt-1">íŠ¹ë³„í•œ ì¼ì´ ìˆì–´ìš”!</p>
                    </div>
                </div>
            </div>

            <!-- STEP 2: ê°ì • ì„ íƒ -->
            <div class="glass-effect rounded-3xl p-8 mb-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">
                    <span class="text-4xl">2ï¸âƒ£</span> ì§€ê¸ˆ ëŠë¼ëŠ” ê°ì •ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”
                </h2>
                
                <div class="flex flex-wrap justify-center gap-4" id="emotionBubbles">
                    <div class="emotion-bubble" data-emotion="ê¸°ì¨">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ˜Š</div>
                            <p class="text-sm font-medium">ê¸°ì¨</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="ì‹ ë‚¨">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ¤—</div>
                            <p class="text-sm font-medium">ì‹ ë‚¨</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="í‰ì˜¨">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ˜Œ</div>
                            <p class="text-sm font-medium">í‰ì˜¨</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="ê°ì‚¬">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ™</div>
                            <p class="text-sm font-medium">ê°ì‚¬</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="ì‚¬ë‘">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ¥°</div>
                            <p class="text-sm font-medium">ì‚¬ë‘</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="ê±±ì •">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ˜Ÿ</div>
                            <p class="text-sm font-medium">ê±±ì •</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="ìŠ¬í””">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ˜¢</div>
                            <p class="text-sm font-medium">ìŠ¬í””</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="í™”ë‚¨">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ˜ </div>
                            <p class="text-sm font-medium">í™”ë‚¨</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="ë‘ë ¤ì›€">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ˜¨</div>
                            <p class="text-sm font-medium">ë‘ë ¤ì›€</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="ë†€ëŒ">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ˜²</div>
                            <p class="text-sm font-medium">ë†€ëŒ</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="ë¶€ë„ëŸ¬ì›€">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ˜³</div>
                            <p class="text-sm font-medium">ë¶€ë„ëŸ¬ì›€</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="í”¼ê³¤">
                        <div class="text-center">
                            <div class="text-5xl mb-1">ğŸ˜´</div>
                            <p class="text-sm font-medium">í”¼ê³¤</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 3: í•œ ì¤„ ì¼ê¸° -->
            <div class="glass-effect rounded-3xl p-8 mb-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">
                    <span class="text-4xl">3ï¸âƒ£</span> ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì„ í•œ ì¤„ë¡œ í‘œí˜„í•´ì£¼ì„¸ìš”
                </h2>
                
                <textarea id="diaryText" 
                    class="w-full p-4 rounded-xl border-2 border-purple-200 focus:border-purple-400 focus:outline-none resize-none text-lg"
                    rows="3"
                    placeholder="ì˜ˆ: ì¹œêµ¬ì™€ í•¨ê»˜ ë†€ì•„ì„œ ì •ë§ ì¦ê±°ì› ì–´ìš”! ğŸˆ"
                    maxlength="100"></textarea>
                
                <div class="text-right mt-2">
                    <span class="text-sm text-gray-500">
                        <span id="charCount">0</span> / 100
                    </span>
                </div>
                
                <!-- ê°ì • ìŠ¤í‹°ì»¤ ì¶”ê°€ -->
                <div class="mt-4">
                    <p class="text-sm text-gray-600 mb-2">ìŠ¤í‹°ì»¤ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="addSticker('ğŸŒŸ')" class="text-2xl hover:scale-125 transition">ğŸŒŸ</button>
                        <button onclick="addSticker('â¤ï¸')" class="text-2xl hover:scale-125 transition">â¤ï¸</button>
                        <button onclick="addSticker('ğŸˆ')" class="text-2xl hover:scale-125 transition">ğŸˆ</button>
                        <button onclick="addSticker('ğŸ¨')" class="text-2xl hover:scale-125 transition">ğŸ¨</button>
                        <button onclick="addSticker('ğŸµ')" class="text-2xl hover:scale-125 transition">ğŸµ</button>
                        <button onclick="addSticker('ğŸ“š')" class="text-2xl hover:scale-125 transition">ğŸ“š</button>
                        <button onclick="addSticker('ğŸƒ')" class="text-2xl hover:scale-125 transition">ğŸƒ</button>
                        <button onclick="addSticker('ğŸ•')" class="text-2xl hover:scale-125 transition">ğŸ•</button>
                        <button onclick="addSticker('ğŸ®')" class="text-2xl hover:scale-125 transition">ğŸ®</button>
                        <button onclick="addSticker('ğŸŒ¸')" class="text-2xl hover:scale-125 transition">ğŸŒ¸</button>
                    </div>
                </div>
            </div>

            <!-- ì €ì¥ ë²„íŠ¼ -->
            <div class="text-center">
                <button onclick="saveCheckin()" 
                    class="px-12 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold rounded-full hover:scale-105 transform transition shadow-lg">
                    ğŸ’¾ ì˜¤ëŠ˜ì˜ ê°ì • ë‚ ì”¨ ì €ì¥í•˜ê¸°
                </button>
            </div>
        </div>

        <!-- ê¸°ë¡ ë³´ê¸° íƒ­ -->
        <div id="historyContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">ğŸ“… ë‚˜ì˜ ê°ì • ë‚ ì”¨ ë‹¬ë ¥</h2>
                
                <!-- ì›” ì„ íƒ -->
                <div class="flex justify-center mb-6">
                    <button onclick="changeMonth(-1)" class="px-4 py-2 bg-purple-500 text-white rounded-l-full hover:bg-purple-600">
                        â—€
                    </button>
                    <div class="px-6 py-2 bg-white" id="currentMonth"></div>
                    <button onclick="changeMonth(1)" class="px-4 py-2 bg-purple-500 text-white rounded-r-full hover:bg-purple-600">
                        â–¶
                    </button>
                </div>
                
                <!-- ë‹¬ë ¥ -->
                <div class="grid grid-cols-7 gap-2 mb-6">
                    <div class="text-center font-bold text-red-500">ì¼</div>
                    <div class="text-center font-bold">ì›”</div>
                    <div class="text-center font-bold">í™”</div>
                    <div class="text-center font-bold">ìˆ˜</div>
                    <div class="text-center font-bold">ëª©</div>
                    <div class="text-center font-bold">ê¸ˆ</div>
                    <div class="text-center font-bold text-blue-500">í† </div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-2">
                    <!-- ë‹¬ë ¥ ë‚ ì§œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
                
                <!-- ì„ íƒëœ ë‚ ì§œ ìƒì„¸ ì •ë³´ -->
                <div id="dayDetail" class="mt-8 p-6 bg-purple-50 rounded-2xl hidden">
                    <h3 class="font-bold text-lg mb-3">ğŸ“ ì´ë‚ ì˜ ê¸°ë¡</h3>
                    <div id="dayDetailContent"></div>
                </div>
            </div>
        </div>

        <!-- íŒ¨í„´ ë¶„ì„ íƒ­ -->
        <div id="patternContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">ğŸ“Š ë‚˜ì˜ ê°ì • íŒ¨í„´ ë¶„ì„</h2>
                
                <!-- í†µê³„ ì¹´ë“œ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-2xl p-6 text-white">
                        <div class="text-4xl mb-2">â˜€ï¸</div>
                        <h3 class="font-bold text-lg">ê°€ì¥ ë§ì€ ë‚ ì”¨</h3>
                        <p class="text-2xl font-bold" id="mostWeather">ë§‘ìŒ</p>
                    </div>
                    <div class="bg-gradient-to-r from-purple-400 to-pink-400 rounded-2xl p-6 text-white">
                        <div class="text-4xl mb-2">ğŸ˜Š</div>
                        <h3 class="font-bold text-lg">ê°€ì¥ ë§ì€ ê°ì •</h3>
                        <p class="text-2xl font-bold" id="mostEmotion">ê¸°ì¨</p>
                    </div>
                    <div class="bg-gradient-to-r from-blue-400 to-cyan-400 rounded-2xl p-6 text-white">
                        <div class="text-4xl mb-2">ğŸ“ˆ</div>
                        <h3 class="font-bold text-lg">ì—°ì† ì²´í¬ì¸</h3>
                        <p class="text-2xl font-bold" id="streakDays">0ì¼</p>
                    </div>
                </div>
                
                <!-- ì£¼ê°„ ì°¨íŠ¸ -->
                <div class="bg-white rounded-2xl p-6 mb-6">
                    <h3 class="font-bold text-lg mb-4">ğŸ“… ì´ë²ˆ ì£¼ ê°ì • ë‚ ì”¨</h3>
                    <canvas id="weekChart" width="400" height="200"></canvas>
                </div>
                
                <!-- ê°ì • ë¶„í¬ ì°¨íŠ¸ -->
                <div class="bg-white rounded-2xl p-6">
                    <h3 class="font-bold text-lg mb-4">ğŸ¨ ê°ì • ë¶„í¬ë„</h3>
                    <canvas id="emotionChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- ì„±ê³µ ë©”ì‹œì§€ ëª¨ë‹¬ -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl p-8 max-w-sm mx-4 transform scale-0 transition-transform" id="successModalContent">
            <div class="text-center">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <h3 class="text-2xl font-bold mb-2">ì €ì¥ ì™„ë£Œ!</h3>
                <p class="text-gray-600 mb-4">ì˜¤ëŠ˜ì˜ ê°ì • ë‚ ì”¨ê°€ ê¸°ë¡ë˜ì—ˆì–´ìš”</p>
                <button onclick="closeSuccessModal()" class="px-6 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                    í™•ì¸
                </button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let selectedWeather = null;
        let selectedEmotions = [];
        let currentDate = new Date();
        let currentViewMonth = new Date();
        let records = JSON.parse(localStorage.getItem('emotionWeatherRecords') || '[]');

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            updateTodayDate();
            setupEventListeners();
            updateCalendar();
            updateCharts();
            updateStats();
        });

        // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
        function updateTodayDate() {
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('todayDate').textContent = 
                currentDate.toLocaleDateString('ko-KR', options);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // ë‚ ì”¨ ì¹´ë“œ í´ë¦­
            document.querySelectorAll('.weather-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.weather-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedWeather = this.dataset.weather;
                });
            });

            // ê°ì • ë²„ë¸” í´ë¦­
            document.querySelectorAll('.emotion-bubble').forEach(bubble => {
                bubble.addEventListener('click', function() {
                    const emotion = this.dataset.emotion;
                    if (selectedEmotions.includes(emotion)) {
                        selectedEmotions = selectedEmotions.filter(e => e !== emotion);
                        this.classList.remove('selected');
                    } else {
                        selectedEmotions.push(emotion);
                        this.classList.add('selected');
                    }
                });
            });

            // í…ìŠ¤íŠ¸ ì…ë ¥ ê¸€ì ìˆ˜ ì¹´ìš´íŒ…
            document.getElementById('diaryText').addEventListener('input', function() {
                document.getElementById('charCount').textContent = this.value.length;
            });
        }

        // íƒ­ ì „í™˜
        function showTab(tab) {
            // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('hover:bg-purple-100');
            });
            
            // ì„ íƒëœ íƒ­ í‘œì‹œ
            document.getElementById(tab + 'Content').classList.remove('hidden');
            document.getElementById(tab + 'Tab').classList.add('bg-purple-500', 'text-white');
            document.getElementById(tab + 'Tab').classList.remove('hover:bg-purple-100');
            
            // íƒ­ë³„ ì´ˆê¸°í™”
            if (tab === 'history') {
                updateCalendar();
            } else if (tab === 'pattern') {
                updateCharts();
                updateStats();
            }
        }

        // ìŠ¤í‹°ì»¤ ì¶”ê°€
        function addSticker(sticker) {
            const textarea = document.getElementById('diaryText');
            textarea.value += ' ' + sticker;
            document.getElementById('charCount').textContent = textarea.value.length;
        }

        // ì²´í¬ì¸ ì €ì¥
        function saveCheckin() {
            if (!selectedWeather) {
                alert('ë‚ ì”¨ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”! ğŸŒ¤');
                return;
            }
            
            if (selectedEmotions.length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ê°ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”! ğŸ˜Š');
                return;
            }
            
            const diary = document.getElementById('diaryText').value.trim();
            if (!diary) {
                alert('ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì„ í•œ ì¤„ë¡œ ì ì–´ì£¼ì„¸ìš”! âœï¸');
                return;
            }
            
            // ê¸°ë¡ ì €ì¥
            const record = {
                date: currentDate.toISOString().split('T')[0],
                weather: selectedWeather,
                emotions: selectedEmotions,
                diary: diary,
                timestamp: new Date().toISOString()
            };
            
            // ì˜¤ëŠ˜ ì´ë¯¸ ê¸°ë¡ì´ ìˆëŠ”ì§€ í™•ì¸
            const existingIndex = records.findIndex(r => r.date === record.date);
            if (existingIndex !== -1) {
                records[existingIndex] = record;
            } else {
                records.push(record);
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('emotionWeatherRecords', JSON.stringify(records));
            
            // ì„±ê³µ ì• ë‹ˆë©”ì´ì…˜
            showSuccessModal();
            createConfetti();
            
            // ì´ˆê¸°í™”
            resetForm();
        }

        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            selectedWeather = null;
            selectedEmotions = [];
            document.querySelectorAll('.weather-card').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.emotion-bubble').forEach(b => b.classList.remove('selected'));
            document.getElementById('diaryText').value = '';
            document.getElementById('charCount').textContent = '0';
        }

        // ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ
        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            const content = document.getElementById('successModalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.style.transform = 'scale(1)';
            }, 100);
        }

        // ì„±ê³µ ëª¨ë‹¬ ë‹«ê¸°
        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            const content = document.getElementById('successModalContent');
            content.style.transform = 'scale(0)';
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // ìƒ‰ì¢…ì´ íš¨ê³¼
        function createConfetti() {
            const colors = ['#FFD93D', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }

        // ë‹¬ë ¥ ì—…ë°ì´íŠ¸
        function updateCalendar() {
            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();
            
            // ì›” í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('currentMonth').textContent = 
                `${year}ë…„ ${month + 1}ì›”`;
            
            // ë‹¬ë ¥ ê·¸ë¦¬ë“œ ìƒì„±
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            let html = '';
            
            // ë¹ˆ ì¹¸ ì±„ìš°ê¸°
            for (let i = 0; i < firstDay; i++) {
                html += '<div></div>';
            }
            
            // ë‚ ì§œ ì±„ìš°ê¸°
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const record = records.find(r => r.date === dateStr);
                
                let weatherIcon = '';
                if (record) {
                    const weatherIcons = {
                        sunny: 'â˜€ï¸',
                        partly: 'â›…',
                        cloudy: 'â˜ï¸',
                        rainy: 'ğŸŒ§ï¸',
                        stormy: 'â›ˆï¸',
                        rainbow: 'ğŸŒˆ'
                    };
                    weatherIcon = weatherIcons[record.weather] || '';
                }
                
                html += `
                    <div class="calendar-day bg-white rounded-lg p-2 text-center cursor-pointer hover:shadow-lg ${record ? 'weather-' + record.weather : ''}" 
                         onclick="showDayDetail('${dateStr}')">
                        <div class="text-sm font-medium">${date}</div>
                        ${weatherIcon ? `<div class="text-2xl">${weatherIcon}</div>` : ''}
                    </div>
                `;
            }
            
            document.getElementById('calendarGrid').innerHTML = html;
        }

        // ë‚ ì§œ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showDayDetail(dateStr) {
            const record = records.find(r => r.date === dateStr);
            const detailDiv = document.getElementById('dayDetail');
            const contentDiv = document.getElementById('dayDetailContent');
            
            if (record) {
                const weatherNames = {
                    sunny: 'ë§‘ìŒ',
                    partly: 'êµ¬ë¦„ ì¡°ê¸ˆ',
                    cloudy: 'íë¦¼',
                    rainy: 'ë¹„',
                    stormy: 'í­í’',
                    rainbow: 'ë¬´ì§€ê°œ'
                };
                
                contentDiv.innerHTML = `
                    <div class="mb-3">
                        <strong>ë‚ ì§œ:</strong> ${dateStr}
                    </div>
                    <div class="mb-3">
                        <strong>ë‚ ì”¨:</strong> ${weatherNames[record.weather]}
                    </div>
                    <div class="mb-3">
                        <strong>ê°ì •:</strong> ${record.emotions.join(', ')}
                    </div>
                    <div class="mb-3">
                        <strong>ì¼ê¸°:</strong> ${record.diary}
                    </div>
                `;
                detailDiv.classList.remove('hidden');
            } else {
                detailDiv.classList.add('hidden');
            }
        }

        // ì›” ë³€ê²½
        function changeMonth(direction) {
            currentViewMonth.setMonth(currentViewMonth.getMonth() + direction);
            updateCalendar();
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts() {
            // ì£¼ê°„ ì°¨íŠ¸
            updateWeekChart();
            
            // ê°ì • ë¶„í¬ ì°¨íŠ¸
            updateEmotionChart();
        }

        // ì£¼ê°„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateWeekChart() {
            const ctx = document.getElementById('weekChart').getContext('2d');
            
            // ìµœê·¼ 7ì¼ ë°ì´í„°
            const weekDays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const weekData = [];
            const weatherColors = {
                sunny: '#FFD93D',
                partly: '#89CFF0',
                cloudy: '#B0C4DE',
                rainy: '#4682B4',
                stormy: '#483D8B',
                rainbow: '#FF6B6B'
            };
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const record = records.find(r => r.date === dateStr);
                
                weekData.push({
                    label: weekDays[date.getDay()],
                    value: record ? 1 : 0,
                    color: record ? weatherColors[record.weather] : '#E5E7EB'
                });
            }
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: weekData.map(d => d.label),
                    datasets: [{
                        label: 'ì²´í¬ì¸',
                        data: weekData.map(d => d.value),
                        backgroundColor: weekData.map(d => d.color)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            display: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // ê°ì • ë¶„í¬ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateEmotionChart() {
            const ctx = document.getElementById('emotionChart').getContext('2d');
            
            // ê°ì • ì¹´ìš´íŠ¸
            const emotionCount = {};
            records.forEach(record => {
                record.emotions.forEach(emotion => {
                    emotionCount[emotion] = (emotionCount[emotion] || 0) + 1;
                });
            });
            
            const sortedEmotions = Object.entries(emotionCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedEmotions.map(e => e[0]),
                    datasets: [{
                        data: sortedEmotions.map(e => e[1]),
                        backgroundColor: [
                            '#FF6B6B',
                            '#4ECDC4',
                            '#45B7D1',
                            '#96CEB4',
                            '#FFEAA7'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            // ê°€ì¥ ë§ì€ ë‚ ì”¨
            const weatherCount = {};
            records.forEach(record => {
                weatherCount[record.weather] = (weatherCount[record.weather] || 0) + 1;
            });
            
            const mostWeatherEntry = Object.entries(weatherCount)
                .sort((a, b) => b[1] - a[1])[0];
            
            if (mostWeatherEntry) {
                const weatherNames = {
                    sunny: 'ë§‘ìŒ',
                    partly: 'êµ¬ë¦„ ì¡°ê¸ˆ',
                    cloudy: 'íë¦¼',
                    rainy: 'ë¹„',
                    stormy: 'í­í’',
                    rainbow: 'ë¬´ì§€ê°œ'
                };
                document.getElementById('mostWeather').textContent = weatherNames[mostWeatherEntry[0]];
            }
            
            // ê°€ì¥ ë§ì€ ê°ì •
            const emotionCount = {};
            records.forEach(record => {
                record.emotions.forEach(emotion => {
                    emotionCount[emotion] = (emotionCount[emotion] || 0) + 1;
                });
            });
            
            const mostEmotionEntry = Object.entries(emotionCount)
                .sort((a, b) => b[1] - a[1])[0];
            
            if (mostEmotionEntry) {
                document.getElementById('mostEmotion').textContent = mostEmotionEntry[0];
            }
            
            // ì—°ì† ì²´í¬ì¸
            let streak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                if (records.find(r => r.date === dateStr)) {
                    streak++;
                } else if (i > 0) {
                    break;
                }
            }
            
            document.getElementById('streakDays').textContent = streak + 'ì¼';
        }
    </script>
</body>
</html>