<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌤 감정 날씨 체크인 - 나의 마음 날씨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .title-font {
            font-family: 'Jua', sans-serif;
        }
        
        .weather-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .weather-card:hover {
            transform: translateY(-10px) scale(1.05);
        }
        
        .weather-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.1);
        }
        
        .emotion-bubble {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .emotion-bubble:hover {
            transform: scale(1.15) rotate(5deg);
        }
        
        .emotion-bubble.selected {
            animation: bounce 0.5s infinite alternate;
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3));
        }
        
        @keyframes bounce {
            from { transform: translateY(0px) scale(1.2); }
            to { transform: translateY(-10px) scale(1.2); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            animation: confetti-fall 3s linear;
            z-index: 1000;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .weather-sunny { background: linear-gradient(135deg, #FFD93D 0%, #FFB347 100%); }
        .weather-partly { background: linear-gradient(135deg, #89CFF0 0%, #6CB4EE 100%); }
        .weather-cloudy { background: linear-gradient(135deg, #B0C4DE 0%, #778899 100%); }
        .weather-rainy { background: linear-gradient(135deg, #4682B4 0%, #1E90FF 100%); }
        .weather-stormy { background: linear-gradient(135deg, #483D8B 0%, #2F4F4F 100%); }
        .weather-rainbow { background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 50%, #45B7D1 100%); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
    <!-- 헤더 -->
    <header class="glass-effect shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-4xl float-animation">🌤</span>
                    <div>
                        <h1 class="title-font text-2xl md:text-3xl text-gray-800">감정 날씨 체크인</h1>
                        <p class="text-sm text-gray-600">오늘 나의 마음 날씨는 어떤가요?</p>
                    </div>
                </div>
                <button onclick="window.location.href='../../'" class="px-4 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                    🏠 메인으로
                </button>
            </div>
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- 탭 네비게이션 -->
        <div class="flex justify-center mb-8">
            <div class="glass-effect rounded-full p-1 inline-flex">
                <button onclick="showTab('checkin')" id="checkinTab" class="tab-btn px-6 py-2 rounded-full bg-purple-500 text-white transition">
                    ✨ 체크인
                </button>
                <button onclick="showTab('history')" id="historyTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    📊 기록 보기
                </button>
                <button onclick="showTab('pattern')" id="patternTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    📈 패턴 분석
                </button>
            </div>
        </div>

        <!-- 체크인 탭 -->
        <div id="checkinContent" class="tab-content">
            <!-- 날짜 표시 -->
            <div class="text-center mb-8">
                <div class="glass-effect rounded-3xl p-6 inline-block">
                    <p class="text-gray-600 mb-2">오늘은</p>
                    <p class="text-3xl font-bold text-gray-800" id="todayDate"></p>
                </div>
            </div>

            <!-- STEP 1: 날씨 선택 -->
            <div class="glass-effect rounded-3xl p-8 mb-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">
                    <span class="text-4xl">1️⃣</span> 오늘 나의 마음 날씨를 선택해주세요
                </h2>
                
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="weatherCards">
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="sunny">
                        <div class="text-6xl mb-2">☀️</div>
                        <h3 class="font-bold text-lg">맑음</h3>
                        <p class="text-sm text-gray-600 mt-1">기분이 아주 좋아요!</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="partly">
                        <div class="text-6xl mb-2">⛅</div>
                        <h3 class="font-bold text-lg">구름 조금</h3>
                        <p class="text-sm text-gray-600 mt-1">대체로 괜찮아요</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="cloudy">
                        <div class="text-6xl mb-2">☁️</div>
                        <h3 class="font-bold text-lg">흐림</h3>
                        <p class="text-sm text-gray-600 mt-1">그저 그래요</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="rainy">
                        <div class="text-6xl mb-2">🌧️</div>
                        <h3 class="font-bold text-lg">비</h3>
                        <p class="text-sm text-gray-600 mt-1">조금 슬퍼요</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="stormy">
                        <div class="text-6xl mb-2">⛈️</div>
                        <h3 class="font-bold text-lg">폭풍</h3>
                        <p class="text-sm text-gray-600 mt-1">많이 힘들어요</p>
                    </div>
                    <div class="weather-card bg-white rounded-2xl p-6 text-center shadow-lg" data-weather="rainbow">
                        <div class="text-6xl mb-2">🌈</div>
                        <h3 class="font-bold text-lg">무지개</h3>
                        <p class="text-sm text-gray-600 mt-1">특별한 일이 있어요!</p>
                    </div>
                </div>
            </div>

            <!-- STEP 2: 감정 선택 -->
            <div class="glass-effect rounded-3xl p-8 mb-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">
                    <span class="text-4xl">2️⃣</span> 지금 느끼는 감정을 모두 선택해주세요
                </h2>
                
                <div class="flex flex-wrap justify-center gap-4" id="emotionBubbles">
                    <div class="emotion-bubble" data-emotion="기쁨">
                        <div class="text-center">
                            <div class="text-5xl mb-1">😊</div>
                            <p class="text-sm font-medium">기쁨</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="신남">
                        <div class="text-center">
                            <div class="text-5xl mb-1">🤗</div>
                            <p class="text-sm font-medium">신남</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="평온">
                        <div class="text-center">
                            <div class="text-5xl mb-1">😌</div>
                            <p class="text-sm font-medium">평온</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="감사">
                        <div class="text-center">
                            <div class="text-5xl mb-1">🙏</div>
                            <p class="text-sm font-medium">감사</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="사랑">
                        <div class="text-center">
                            <div class="text-5xl mb-1">🥰</div>
                            <p class="text-sm font-medium">사랑</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="걱정">
                        <div class="text-center">
                            <div class="text-5xl mb-1">😟</div>
                            <p class="text-sm font-medium">걱정</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="슬픔">
                        <div class="text-center">
                            <div class="text-5xl mb-1">😢</div>
                            <p class="text-sm font-medium">슬픔</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="화남">
                        <div class="text-center">
                            <div class="text-5xl mb-1">😠</div>
                            <p class="text-sm font-medium">화남</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="두려움">
                        <div class="text-center">
                            <div class="text-5xl mb-1">😨</div>
                            <p class="text-sm font-medium">두려움</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="놀람">
                        <div class="text-center">
                            <div class="text-5xl mb-1">😲</div>
                            <p class="text-sm font-medium">놀람</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="부끄러움">
                        <div class="text-center">
                            <div class="text-5xl mb-1">😳</div>
                            <p class="text-sm font-medium">부끄러움</p>
                        </div>
                    </div>
                    <div class="emotion-bubble" data-emotion="피곤">
                        <div class="text-center">
                            <div class="text-5xl mb-1">😴</div>
                            <p class="text-sm font-medium">피곤</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 3: 한 줄 일기 -->
            <div class="glass-effect rounded-3xl p-8 mb-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">
                    <span class="text-4xl">3️⃣</span> 오늘의 기분을 한 줄로 표현해주세요
                </h2>
                
                <textarea id="diaryText" 
                    class="w-full p-4 rounded-xl border-2 border-purple-200 focus:border-purple-400 focus:outline-none resize-none text-lg"
                    rows="3"
                    placeholder="예: 친구와 함께 놀아서 정말 즐거웠어요! 🎈"
                    maxlength="100"></textarea>
                
                <div class="text-right mt-2">
                    <span class="text-sm text-gray-500">
                        <span id="charCount">0</span> / 100
                    </span>
                </div>
                
                <!-- 감정 스티커 추가 -->
                <div class="mt-4">
                    <p class="text-sm text-gray-600 mb-2">스티커를 추가해보세요!</p>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="addSticker('🌟')" class="text-2xl hover:scale-125 transition">🌟</button>
                        <button onclick="addSticker('❤️')" class="text-2xl hover:scale-125 transition">❤️</button>
                        <button onclick="addSticker('🎈')" class="text-2xl hover:scale-125 transition">🎈</button>
                        <button onclick="addSticker('🎨')" class="text-2xl hover:scale-125 transition">🎨</button>
                        <button onclick="addSticker('🎵')" class="text-2xl hover:scale-125 transition">🎵</button>
                        <button onclick="addSticker('📚')" class="text-2xl hover:scale-125 transition">📚</button>
                        <button onclick="addSticker('🏃')" class="text-2xl hover:scale-125 transition">🏃</button>
                        <button onclick="addSticker('🍕')" class="text-2xl hover:scale-125 transition">🍕</button>
                        <button onclick="addSticker('🎮')" class="text-2xl hover:scale-125 transition">🎮</button>
                        <button onclick="addSticker('🌸')" class="text-2xl hover:scale-125 transition">🌸</button>
                    </div>
                </div>
            </div>

            <!-- 저장 버튼 -->
            <div class="text-center">
                <button onclick="saveCheckin()" 
                    class="px-12 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold rounded-full hover:scale-105 transform transition shadow-lg">
                    💾 오늘의 감정 날씨 저장하기
                </button>
            </div>
        </div>

        <!-- 기록 보기 탭 -->
        <div id="historyContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">📅 나의 감정 날씨 달력</h2>
                
                <!-- 월 선택 -->
                <div class="flex justify-center mb-6">
                    <button onclick="changeMonth(-1)" class="px-4 py-2 bg-purple-500 text-white rounded-l-full hover:bg-purple-600">
                        ◀
                    </button>
                    <div class="px-6 py-2 bg-white" id="currentMonth"></div>
                    <button onclick="changeMonth(1)" class="px-4 py-2 bg-purple-500 text-white rounded-r-full hover:bg-purple-600">
                        ▶
                    </button>
                </div>
                
                <!-- 달력 -->
                <div class="grid grid-cols-7 gap-2 mb-6">
                    <div class="text-center font-bold text-red-500">일</div>
                    <div class="text-center font-bold">월</div>
                    <div class="text-center font-bold">화</div>
                    <div class="text-center font-bold">수</div>
                    <div class="text-center font-bold">목</div>
                    <div class="text-center font-bold">금</div>
                    <div class="text-center font-bold text-blue-500">토</div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-2">
                    <!-- 달력 날짜들이 여기에 동적으로 생성됨 -->
                </div>
                
                <!-- 선택된 날짜 상세 정보 -->
                <div id="dayDetail" class="mt-8 p-6 bg-purple-50 rounded-2xl hidden">
                    <h3 class="font-bold text-lg mb-3">📝 이날의 기록</h3>
                    <div id="dayDetailContent"></div>
                </div>
            </div>
        </div>

        <!-- 패턴 분석 탭 -->
        <div id="patternContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">📊 나의 감정 패턴 분석</h2>
                
                <!-- 통계 카드 -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-2xl p-6 text-white">
                        <div class="text-4xl mb-2">☀️</div>
                        <h3 class="font-bold text-lg">가장 많은 날씨</h3>
                        <p class="text-2xl font-bold" id="mostWeather">맑음</p>
                    </div>
                    <div class="bg-gradient-to-r from-purple-400 to-pink-400 rounded-2xl p-6 text-white">
                        <div class="text-4xl mb-2">😊</div>
                        <h3 class="font-bold text-lg">가장 많은 감정</h3>
                        <p class="text-2xl font-bold" id="mostEmotion">기쁨</p>
                    </div>
                    <div class="bg-gradient-to-r from-blue-400 to-cyan-400 rounded-2xl p-6 text-white">
                        <div class="text-4xl mb-2">📈</div>
                        <h3 class="font-bold text-lg">연속 체크인</h3>
                        <p class="text-2xl font-bold" id="streakDays">0일</p>
                    </div>
                </div>
                
                <!-- 주간 차트 -->
                <div class="bg-white rounded-2xl p-6 mb-6">
                    <h3 class="font-bold text-lg mb-4">📅 이번 주 감정 날씨</h3>
                    <canvas id="weekChart" width="400" height="200"></canvas>
                </div>
                
                <!-- 감정 분포 차트 -->
                <div class="bg-white rounded-2xl p-6">
                    <h3 class="font-bold text-lg mb-4">🎨 감정 분포도</h3>
                    <canvas id="emotionChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- 성공 메시지 모달 -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl p-8 max-w-sm mx-4 transform scale-0 transition-transform" id="successModalContent">
            <div class="text-center">
                <div class="text-6xl mb-4">🎉</div>
                <h3 class="text-2xl font-bold mb-2">저장 완료!</h3>
                <p class="text-gray-600 mb-4">오늘의 감정 날씨가 기록되었어요</p>
                <button onclick="closeSuccessModal()" class="px-6 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                    확인
                </button>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let selectedWeather = null;
        let selectedEmotions = [];
        let currentDate = new Date();
        let currentViewMonth = new Date();
        let records = JSON.parse(localStorage.getItem('emotionWeatherRecords') || '[]');

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            updateTodayDate();
            setupEventListeners();
            updateCalendar();
            updateCharts();
            updateStats();
        });

        // 오늘 날짜 표시
        function updateTodayDate() {
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('todayDate').textContent = 
                currentDate.toLocaleDateString('ko-KR', options);
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 날씨 카드 클릭
            document.querySelectorAll('.weather-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.weather-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedWeather = this.dataset.weather;
                });
            });

            // 감정 버블 클릭
            document.querySelectorAll('.emotion-bubble').forEach(bubble => {
                bubble.addEventListener('click', function() {
                    const emotion = this.dataset.emotion;
                    if (selectedEmotions.includes(emotion)) {
                        selectedEmotions = selectedEmotions.filter(e => e !== emotion);
                        this.classList.remove('selected');
                    } else {
                        selectedEmotions.push(emotion);
                        this.classList.add('selected');
                    }
                });
            });

            // 텍스트 입력 글자 수 카운팅
            document.getElementById('diaryText').addEventListener('input', function() {
                document.getElementById('charCount').textContent = this.value.length;
            });
        }

        // 탭 전환
        function showTab(tab) {
            // 모든 탭 컨텐츠 숨기기
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // 모든 탭 버튼 스타일 초기화
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('hover:bg-purple-100');
            });
            
            // 선택된 탭 표시
            document.getElementById(tab + 'Content').classList.remove('hidden');
            document.getElementById(tab + 'Tab').classList.add('bg-purple-500', 'text-white');
            document.getElementById(tab + 'Tab').classList.remove('hover:bg-purple-100');
            
            // 탭별 초기화
            if (tab === 'history') {
                updateCalendar();
            } else if (tab === 'pattern') {
                updateCharts();
                updateStats();
            }
        }

        // 스티커 추가
        function addSticker(sticker) {
            const textarea = document.getElementById('diaryText');
            textarea.value += ' ' + sticker;
            document.getElementById('charCount').textContent = textarea.value.length;
        }

        // 체크인 저장
        function saveCheckin() {
            if (!selectedWeather) {
                alert('날씨를 선택해주세요! 🌤');
                return;
            }
            
            if (selectedEmotions.length === 0) {
                alert('최소 하나의 감정을 선택해주세요! 😊');
                return;
            }
            
            const diary = document.getElementById('diaryText').value.trim();
            if (!diary) {
                alert('오늘의 기분을 한 줄로 적어주세요! ✏️');
                return;
            }
            
            // 기록 저장
            const record = {
                date: currentDate.toISOString().split('T')[0],
                weather: selectedWeather,
                emotions: selectedEmotions,
                diary: diary,
                timestamp: new Date().toISOString()
            };
            
            // 오늘 이미 기록이 있는지 확인
            const existingIndex = records.findIndex(r => r.date === record.date);
            if (existingIndex !== -1) {
                records[existingIndex] = record;
            } else {
                records.push(record);
            }
            
            // 로컬 스토리지에 저장
            localStorage.setItem('emotionWeatherRecords', JSON.stringify(records));
            
            // 성공 애니메이션
            showSuccessModal();
            createConfetti();
            
            // 초기화
            resetForm();
        }

        // 폼 초기화
        function resetForm() {
            selectedWeather = null;
            selectedEmotions = [];
            document.querySelectorAll('.weather-card').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.emotion-bubble').forEach(b => b.classList.remove('selected'));
            document.getElementById('diaryText').value = '';
            document.getElementById('charCount').textContent = '0';
        }

        // 성공 모달 표시
        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            const content = document.getElementById('successModalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.style.transform = 'scale(1)';
            }, 100);
        }

        // 성공 모달 닫기
        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            const content = document.getElementById('successModalContent');
            content.style.transform = 'scale(0)';
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // 색종이 효과
        function createConfetti() {
            const colors = ['#FFD93D', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }

        // 달력 업데이트
        function updateCalendar() {
            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();
            
            // 월 표시 업데이트
            document.getElementById('currentMonth').textContent = 
                `${year}년 ${month + 1}월`;
            
            // 달력 그리드 생성
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            let html = '';
            
            // 빈 칸 채우기
            for (let i = 0; i < firstDay; i++) {
                html += '<div></div>';
            }
            
            // 날짜 채우기
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const record = records.find(r => r.date === dateStr);
                
                let weatherIcon = '';
                if (record) {
                    const weatherIcons = {
                        sunny: '☀️',
                        partly: '⛅',
                        cloudy: '☁️',
                        rainy: '🌧️',
                        stormy: '⛈️',
                        rainbow: '🌈'
                    };
                    weatherIcon = weatherIcons[record.weather] || '';
                }
                
                html += `
                    <div class="calendar-day bg-white rounded-lg p-2 text-center cursor-pointer hover:shadow-lg ${record ? 'weather-' + record.weather : ''}" 
                         onclick="showDayDetail('${dateStr}')">
                        <div class="text-sm font-medium">${date}</div>
                        ${weatherIcon ? `<div class="text-2xl">${weatherIcon}</div>` : ''}
                    </div>
                `;
            }
            
            document.getElementById('calendarGrid').innerHTML = html;
        }

        // 날짜 상세 정보 표시
        function showDayDetail(dateStr) {
            const record = records.find(r => r.date === dateStr);
            const detailDiv = document.getElementById('dayDetail');
            const contentDiv = document.getElementById('dayDetailContent');
            
            if (record) {
                const weatherNames = {
                    sunny: '맑음',
                    partly: '구름 조금',
                    cloudy: '흐림',
                    rainy: '비',
                    stormy: '폭풍',
                    rainbow: '무지개'
                };
                
                contentDiv.innerHTML = `
                    <div class="mb-3">
                        <strong>날짜:</strong> ${dateStr}
                    </div>
                    <div class="mb-3">
                        <strong>날씨:</strong> ${weatherNames[record.weather]}
                    </div>
                    <div class="mb-3">
                        <strong>감정:</strong> ${record.emotions.join(', ')}
                    </div>
                    <div class="mb-3">
                        <strong>일기:</strong> ${record.diary}
                    </div>
                `;
                detailDiv.classList.remove('hidden');
            } else {
                detailDiv.classList.add('hidden');
            }
        }

        // 월 변경
        function changeMonth(direction) {
            currentViewMonth.setMonth(currentViewMonth.getMonth() + direction);
            updateCalendar();
        }

        // 차트 업데이트
        function updateCharts() {
            // 주간 차트
            updateWeekChart();
            
            // 감정 분포 차트
            updateEmotionChart();
        }

        // 주간 차트 업데이트
        function updateWeekChart() {
            const ctx = document.getElementById('weekChart').getContext('2d');
            
            // 최근 7일 데이터
            const weekDays = ['일', '월', '화', '수', '목', '금', '토'];
            const weekData = [];
            const weatherColors = {
                sunny: '#FFD93D',
                partly: '#89CFF0',
                cloudy: '#B0C4DE',
                rainy: '#4682B4',
                stormy: '#483D8B',
                rainbow: '#FF6B6B'
            };
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const record = records.find(r => r.date === dateStr);
                
                weekData.push({
                    label: weekDays[date.getDay()],
                    value: record ? 1 : 0,
                    color: record ? weatherColors[record.weather] : '#E5E7EB'
                });
            }
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: weekData.map(d => d.label),
                    datasets: [{
                        label: '체크인',
                        data: weekData.map(d => d.value),
                        backgroundColor: weekData.map(d => d.color)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            display: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // 감정 분포 차트 업데이트
        function updateEmotionChart() {
            const ctx = document.getElementById('emotionChart').getContext('2d');
            
            // 감정 카운트
            const emotionCount = {};
            records.forEach(record => {
                record.emotions.forEach(emotion => {
                    emotionCount[emotion] = (emotionCount[emotion] || 0) + 1;
                });
            });
            
            const sortedEmotions = Object.entries(emotionCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedEmotions.map(e => e[0]),
                    datasets: [{
                        data: sortedEmotions.map(e => e[1]),
                        backgroundColor: [
                            '#FF6B6B',
                            '#4ECDC4',
                            '#45B7D1',
                            '#96CEB4',
                            '#FFEAA7'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // 통계 업데이트
        function updateStats() {
            // 가장 많은 날씨
            const weatherCount = {};
            records.forEach(record => {
                weatherCount[record.weather] = (weatherCount[record.weather] || 0) + 1;
            });
            
            const mostWeatherEntry = Object.entries(weatherCount)
                .sort((a, b) => b[1] - a[1])[0];
            
            if (mostWeatherEntry) {
                const weatherNames = {
                    sunny: '맑음',
                    partly: '구름 조금',
                    cloudy: '흐림',
                    rainy: '비',
                    stormy: '폭풍',
                    rainbow: '무지개'
                };
                document.getElementById('mostWeather').textContent = weatherNames[mostWeatherEntry[0]];
            }
            
            // 가장 많은 감정
            const emotionCount = {};
            records.forEach(record => {
                record.emotions.forEach(emotion => {
                    emotionCount[emotion] = (emotionCount[emotion] || 0) + 1;
                });
            });
            
            const mostEmotionEntry = Object.entries(emotionCount)
                .sort((a, b) => b[1] - a[1])[0];
            
            if (mostEmotionEntry) {
                document.getElementById('mostEmotion').textContent = mostEmotionEntry[0];
            }
            
            // 연속 체크인
            let streak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                if (records.find(r => r.date === dateStr)) {
                    streak++;
                } else if (i > 0) {
                    break;
                }
            }
            
            document.getElementById('streakDays').textContent = streak + '일';
        }
    </script>
</body>
</html>