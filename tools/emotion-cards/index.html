<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💎 디지털 감정 카드 - 다양한 감정 알아보기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .title-font {
            font-family: 'Jua', sans-serif;
        }
        
        .emotion-card {
            perspective: 1000px;
            height: 280px;
            cursor: pointer;
        }
        
        .emotion-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .emotion-card.flipped .emotion-card-inner {
            transform: rotateY(180deg);
        }
        
        .emotion-card-front, .emotion-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .emotion-card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .emotion-card-back {
            background: white;
            transform: rotateY(180deg);
            color: #333;
        }
        
        .card-collected {
            animation: collect 0.5s ease;
        }
        
        @keyframes collect {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .game-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .game-card.selected {
            border: 3px solid #10b981;
            transform: scale(0.95);
        }
        
        .game-card.matched {
            background: #10b981 !important;
            animation: matchPulse 0.5s ease;
        }
        
        @keyframes matchPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .star-animation {
            animation: starSpin 2s linear infinite;
        }
        
        @keyframes starSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .badge-new {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .badge-collected {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        
        .emotion-category-happy { background: linear-gradient(135deg, #FFD93D 0%, #FFB347 100%); }
        .emotion-category-sad { background: linear-gradient(135deg, #4682B4 0%, #1E90FF 100%); }
        .emotion-category-angry { background: linear-gradient(135deg, #FF6B6B 0%, #FF4757 100%); }
        .emotion-category-fear { background: linear-gradient(135deg, #6C5CE7 0%, #A29BFE 100%); }
        .emotion-category-surprise { background: linear-gradient(135deg, #FFA502 0%, #FF6348 100%); }
        .emotion-category-love { background: linear-gradient(135deg, #FD79A8 0%, #FDCB6E 100%); }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            animation: confetti-fall 3s linear;
            z-index: 1000;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            transition: width 0.5s ease;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
        }
        
        .avatar-selector {
            display: inline-block;
            padding: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .avatar-selector:hover {
            background: rgba(147, 51, 234, 0.1);
            transform: scale(1.1);
        }
        
        .avatar-selector.selected {
            background: rgba(147, 51, 234, 0.2);
            border: 2px solid #9333ea;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
    <!-- 헤더 -->
    <header class="glass-effect shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-4xl float-animation">💎</span>
                    <div>
                        <h1 class="title-font text-2xl md:text-3xl text-gray-800">디지털 감정 카드</h1>
                        <p class="text-sm text-gray-600">다양한 감정을 배우고 이해해요</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <!-- 사용자 프로필 표시 -->
                    <div id="userProfile" class="hidden user-profile">
                        <span id="userAvatar" class="text-2xl">🦁</span>
                        <span id="userName" class="font-bold">학생</span>
                    </div>
                    <div class="bg-purple-100 px-4 py-2 rounded-full">
                        <span class="text-purple-700 font-bold">
                            🏆 <span id="totalPoints">0</span>점
                        </span>
                    </div>
                    <button onclick="showDataMenu()" class="px-4 py-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition">
                        💾 데이터
                    </button>
                    <button onclick="window.location.href='../../'" class="px-4 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                        🏠 메인으로
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- 탭 네비게이션 -->
        <div class="flex justify-center mb-8">
            <div class="glass-effect rounded-full p-1 inline-flex">
                <button onclick="showTab('gallery')" id="galleryTab" class="tab-btn px-6 py-2 rounded-full bg-purple-500 text-white transition">
                    📚 감정 갤러리
                </button>
                <button onclick="showTab('game')" id="gameTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    🎮 감정 게임
                </button>
                <button onclick="showTab('create')" id="createTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    ✏️ 카드 만들기
                </button>
                <button onclick="showTab('collection')" id="collectionTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    🏆 나의 컬렉션
                </button>
            </div>
        </div>

        <!-- 감정 갤러리 탭 -->
        <div id="galleryContent" class="tab-content">
            <!-- 카테고리 필터 -->
            <div class="glass-effect rounded-3xl p-6 mb-8">
                <h3 class="font-bold text-lg mb-4 text-gray-800">🎨 감정 카테고리</h3>
                <div class="flex flex-wrap gap-3 justify-center">
                    <button onclick="filterCategory('all')" class="category-btn px-4 py-2 bg-purple-500 text-white rounded-full">
                        전체
                    </button>
                    <button onclick="filterCategory('happy')" class="category-btn px-4 py-2 bg-yellow-400 text-white rounded-full">
                        😊 기쁨
                    </button>
                    <button onclick="filterCategory('sad')" class="category-btn px-4 py-2 bg-blue-400 text-white rounded-full">
                        😢 슬픔
                    </button>
                    <button onclick="filterCategory('angry')" class="category-btn px-4 py-2 bg-red-400 text-white rounded-full">
                        😠 화남
                    </button>
                    <button onclick="filterCategory('fear')" class="category-btn px-4 py-2 bg-purple-400 text-white rounded-full">
                        😨 두려움
                    </button>
                    <button onclick="filterCategory('surprise')" class="category-btn px-4 py-2 bg-orange-400 text-white rounded-full">
                        😲 놀람
                    </button>
                    <button onclick="filterCategory('love')" class="category-btn px-4 py-2 bg-pink-400 text-white rounded-full">
                        🥰 사랑
                    </button>
                </div>
            </div>

            <!-- 감정 카드 그리드 -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="emotionCardsGrid">
                <!-- 카드들이 JavaScript로 동적 생성됨 -->
            </div>
        </div>

        <!-- 감정 게임 탭 -->
        <div id="gameContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">🎮 감정 맞추기 게임</h2>
                
                <!-- 게임 선택 -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-purple-400 to-pink-400 rounded-2xl p-6 text-white text-center cursor-pointer hover:scale-105 transition" onclick="startGame('match')">
                        <div class="text-4xl mb-2">🎯</div>
                        <h3 class="font-bold text-lg">감정 매칭</h3>
                        <p class="text-sm mt-2">이모지와 감정 단어 연결하기</p>
                    </div>
                    <div class="bg-gradient-to-r from-blue-400 to-cyan-400 rounded-2xl p-6 text-white text-center cursor-pointer hover:scale-105 transition" onclick="startGame('quiz')">
                        <div class="text-4xl mb-2">❓</div>
                        <h3 class="font-bold text-lg">감정 퀴즈</h3>
                        <p class="text-sm mt-2">상황 보고 감정 맞추기</p>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-2xl p-6 text-white text-center cursor-pointer hover:scale-105 transition" onclick="startGame('memory')">
                        <div class="text-4xl mb-2">🧩</div>
                        <h3 class="font-bold text-lg">감정 메모리</h3>
                        <p class="text-sm mt-2">같은 감정 카드 찾기</p>
                    </div>
                </div>

                <!-- 게임 영역 -->
                <div id="gameArea" class="hidden">
                    <!-- 게임이 여기에 동적으로 로드됨 -->
                </div>
            </div>
        </div>

        <!-- 카드 만들기 탭 -->
        <div id="createContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">✏️ 나만의 감정 카드 만들기</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- 입력 폼 -->
                    <div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">감정 이름</label>
                            <input type="text" id="customEmotionName" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="예: 설렘">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">이모지 선택</label>
                            <div class="grid grid-cols-6 gap-2">
                                <button onclick="selectEmoji('😊')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😊</button>
                                <button onclick="selectEmoji('😃')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😃</button>
                                <button onclick="selectEmoji('😍')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😍</button>
                                <button onclick="selectEmoji('🤗')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">🤗</button>
                                <button onclick="selectEmoji('😎')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😎</button>
                                <button onclick="selectEmoji('😴')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😴</button>
                                <button onclick="selectEmoji('😮')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😮</button>
                                <button onclick="selectEmoji('😯')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😯</button>
                                <button onclick="selectEmoji('😢')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😢</button>
                                <button onclick="selectEmoji('😭')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😭</button>
                                <button onclick="selectEmoji('😡')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">😡</button>
                                <button onclick="selectEmoji('🤯')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">🤯</button>
                            </div>
                            <div class="mt-2">
                                <span class="text-sm text-gray-600">선택된 이모지: </span>
                                <span id="selectedEmoji" class="text-3xl">❓</span>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">색상 선택</label>
                            <div class="flex gap-2">
                                <button onclick="selectColor('#FFD93D')" class="w-10 h-10 rounded" style="background: #FFD93D"></button>
                                <button onclick="selectColor('#FF6B6B')" class="w-10 h-10 rounded" style="background: #FF6B6B"></button>
                                <button onclick="selectColor('#4ECDC4')" class="w-10 h-10 rounded" style="background: #4ECDC4"></button>
                                <button onclick="selectColor('#A29BFE')" class="w-10 h-10 rounded" style="background: #A29BFE"></button>
                                <button onclick="selectColor('#FD79A8')" class="w-10 h-10 rounded" style="background: #FD79A8"></button>
                                <button onclick="selectColor('#6C5CE7')" class="w-10 h-10 rounded" style="background: #6C5CE7"></button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">설명</label>
                            <textarea id="customEmotionDesc" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none resize-none" rows="3" placeholder="이 감정은 언제 느끼나요?"></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">예시 상황</label>
                            <input type="text" id="customEmotionExample" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="예: 선물을 받았을 때">
                        </div>
                        
                        <button onclick="saveCustomCard()" class="w-full px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-full hover:scale-105 transition">
                            💾 카드 저장하기
                        </button>
                    </div>
                    
                    <!-- 미리보기 -->
                    <div>
                        <h3 class="font-bold text-lg mb-4 text-gray-700">미리보기</h3>
                        <div class="emotion-card">
                            <div class="emotion-card-inner">
                                <div class="emotion-card-front" id="previewCardFront">
                                    <div class="text-6xl mb-4" id="previewEmoji">❓</div>
                                    <h3 class="text-2xl font-bold" id="previewName">감정 이름</h3>
                                </div>
                                <div class="emotion-card-back">
                                    <h3 class="text-xl font-bold mb-3" id="previewNameBack">감정 이름</h3>
                                    <p class="text-sm mb-3" id="previewDesc">설명을 입력해주세요</p>
                                    <p class="text-sm text-gray-600" id="previewExample">예시: -</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 나의 컬렉션 탭 -->
        <div id="collectionContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">🏆 나의 감정 카드 컬렉션</h2>
                
                <!-- 데이터 관리 버튼 -->
                <div class="flex justify-center gap-3 mb-6">
                    <button onclick="exportLearningData()" class="px-4 py-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition">
                        📥 학습 기록 다운로드 (JSON)
                    </button>
                    <button onclick="generateVisualReport()" class="px-4 py-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition">
                        🖼️ 성과 리포트 이미지
                    </button>
                    <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                        📤 학습 기록 불러오기
                    </button>
                    <input type="file" id="importFile" hidden accept=".json" onchange="importLearningData(this.files[0])">
                </div>
                
                <!-- 통계 -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-purple-400 to-pink-400 rounded-2xl p-4 text-white text-center">
                        <div class="text-3xl mb-1">📚</div>
                        <div class="text-2xl font-bold" id="totalCards">0</div>
                        <div class="text-sm">전체 카드</div>
                    </div>
                    <div class="bg-gradient-to-r from-blue-400 to-cyan-400 rounded-2xl p-4 text-white text-center">
                        <div class="text-3xl mb-1">✅</div>
                        <div class="text-2xl font-bold" id="collectedCards">0</div>
                        <div class="text-sm">수집한 카드</div>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-2xl p-4 text-white text-center">
                        <div class="text-3xl mb-1">🎯</div>
                        <div class="text-2xl font-bold" id="completionRate">0%</div>
                        <div class="text-sm">완성도</div>
                    </div>
                    <div class="bg-gradient-to-r from-green-400 to-emerald-400 rounded-2xl p-4 text-white text-center">
                        <div class="text-3xl mb-1">✏️</div>
                        <div class="text-2xl font-bold" id="customCards">0</div>
                        <div class="text-sm">내가 만든 카드</div>
                    </div>
                </div>
                
                <!-- 진행률 바 -->
                <div class="mb-8">
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-700 font-medium">컬렉션 진행률</span>
                        <span class="text-gray-700 font-medium" id="progressText">0/30</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- 수집한 카드 목록 -->
                <div>
                    <h3 class="font-bold text-lg mb-4 text-gray-700">📂 수집한 카드</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="collectionGrid">
                        <!-- 수집한 카드들이 여기에 표시됨 -->
                    </div>
                </div>
                
                <!-- 내가 만든 카드 목록 -->
                <div class="mt-8">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">✨ 내가 만든 카드</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="customCardsGrid">
                        <!-- 커스텀 카드들이 여기에 표시됨 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 사용자 프로필 모달 -->
    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl p-8 max-w-md mx-4">
            <h3 class="text-2xl font-bold mb-4 text-center">👋 안녕하세요!</h3>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">이름을 입력해주세요</label>
                <input type="text" id="profileNameInput" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="예: 김학생">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">학급</label>
                <input type="text" id="profileClassInput" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="예: 3학년 2반">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">아바타 선택</label>
                <div class="grid grid-cols-6 gap-2">
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🦁')">🦁</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🐶')">🐶</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🐱')">🐱</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🐰')">🐰</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🐼')">🐼</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🦊')">🦊</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🐸')">🐸</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🐧')">🐧</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🦋')">🦋</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🌟')">🌟</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🌈')">🌈</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('🎈')">🎈</span>
                </div>
            </div>
            <button onclick="saveProfile()" class="w-full px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-full hover:scale-105 transition">
                시작하기
            </button>
        </div>
    </div>

    <!-- 데이터 메뉴 모달 -->
    <div id="dataMenuModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl p-8 max-w-md mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center">💾 데이터 관리</h3>
            <div class="space-y-3">
                <button onclick="exportLearningData(); closeDataMenu();" class="w-full px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                    📥 학습 기록 다운로드 (JSON)
                </button>
                <button onclick="generateVisualReport(); closeDataMenu();" class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                    🖼️ 성과 리포트 이미지 다운로드
                </button>
                <button onclick="document.getElementById('importFileModal').click(); closeDataMenu();" class="w-full px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition">
                    📤 학습 기록 불러오기
                </button>
                <input type="file" id="importFileModal" hidden accept=".json" onchange="importLearningData(this.files[0])">
                <button onclick="changeProfile(); closeDataMenu();" class="w-full px-4 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition">
                    👤 프로필 변경
                </button>
                <button onclick="closeDataMenu()" class="w-full px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                    닫기
                </button>
            </div>
        </div>
    </div>

    <!-- 성공 모달 -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl p-8 max-w-sm mx-4 transform scale-0 transition-transform" id="successModalContent">
            <div class="text-center">
                <div class="text-6xl mb-4" id="modalIcon">🎉</div>
                <h3 class="text-2xl font-bold mb-2" id="modalTitle">성공!</h3>
                <p class="text-gray-600 mb-4" id="modalMessage">잘했어요!</p>
                <button onclick="closeModal()" class="px-6 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                    확인
                </button>
            </div>
        </div>
    </div>

    <script>
        // 감정 카드 데이터
        const emotionCards = [
            // 기쁨 카테고리
            { id: 1, name: '기쁨', emoji: '😊', category: 'happy', color: '#FFD93D', desc: '마음이 즐겁고 행복한 느낌', example: '친구와 놀 때' },
            { id: 2, name: '신남', emoji: '🤗', category: 'happy', color: '#FFD93D', desc: '에너지가 넘치고 들뜬 기분', example: '소풍 가는 날' },
            { id: 3, name: '만족', emoji: '😌', category: 'happy', color: '#FFD93D', desc: '마음이 편안하고 충분한 느낌', example: '맛있는 걸 먹었을 때' },
            { id: 4, name: '자랑스러움', emoji: '😎', category: 'happy', color: '#FFD93D', desc: '스스로가 대견한 느낌', example: '시험을 잘 봤을 때' },
            { id: 5, name: '감사', emoji: '🙏', category: 'happy', color: '#FFD93D', desc: '고마운 마음', example: '도움을 받았을 때' },
            
            // 슬픔 카테고리
            { id: 6, name: '슬픔', emoji: '😢', category: 'sad', color: '#4682B4', desc: '마음이 아프고 눈물이 나는 느낌', example: '친구와 헤어질 때' },
            { id: 7, name: '외로움', emoji: '😔', category: 'sad', color: '#4682B4', desc: '혼자인 것 같은 느낌', example: '친구들이 없을 때' },
            { id: 8, name: '실망', emoji: '😞', category: 'sad', color: '#4682B4', desc: '기대와 달라서 속상한 느낌', example: '약속이 취소됐을 때' },
            { id: 9, name: '그리움', emoji: '🥺', category: 'sad', color: '#4682B4', desc: '보고 싶은 마음', example: '가족이 보고 싶을 때' },
            { id: 10, name: '후회', emoji: '😓', category: 'sad', color: '#4682B4', desc: '되돌리고 싶은 마음', example: '실수했을 때' },
            
            // 화남 카테고리
            { id: 11, name: '화남', emoji: '😠', category: 'angry', color: '#FF6B6B', desc: '속이 부글부글 끓는 느낌', example: '불공평할 때' },
            { id: 12, name: '짜증', emoji: '😤', category: 'angry', color: '#FF6B6B', desc: '신경이 거슬리는 느낌', example: '방해받을 때' },
            { id: 13, name: '답답함', emoji: '😣', category: 'angry', color: '#FF6B6B', desc: '막힌 것 같은 느낌', example: '이해받지 못할 때' },
            { id: 14, name: '억울함', emoji: '😖', category: 'angry', color: '#FF6B6B', desc: '공평하지 않다고 느끼는 마음', example: '오해받을 때' },
            { id: 15, name: '분노', emoji: '🤬', category: 'angry', color: '#FF6B6B', desc: '매우 화가 난 상태', example: '괴롭힘을 당할 때' },
            
            // 두려움 카테고리
            { id: 16, name: '두려움', emoji: '😨', category: 'fear', color: '#6C5CE7', desc: '무서운 느낌', example: '어둠 속에 있을 때' },
            { id: 17, name: '걱정', emoji: '😟', category: 'fear', color: '#6C5CE7', desc: '나쁜 일이 생길까봐 불안한 마음', example: '시험 보기 전' },
            { id: 18, name: '긴장', emoji: '😰', category: 'fear', color: '#6C5CE7', desc: '마음이 조마조마한 느낌', example: '발표할 때' },
            { id: 19, name: '불안', emoji: '😥', category: 'fear', color: '#6C5CE7', desc: '마음이 편하지 않은 상태', example: '새로운 곳에 갈 때' },
            { id: 20, name: '초조함', emoji: '😬', category: 'fear', color: '#6C5CE7', desc: '빨리 해야 할 것 같은 느낌', example: '시간이 부족할 때' },
            
            // 놀람 카테고리
            { id: 21, name: '놀람', emoji: '😲', category: 'surprise', color: '#FFA502', desc: '예상하지 못한 일에 깜짝 놀란 느낌', example: '깜짝 선물 받을 때' },
            { id: 22, name: '신기함', emoji: '🤔', category: 'surprise', color: '#FFA502', desc: '처음 보는 것에 대한 호기심', example: '새로운 것을 발견할 때' },
            { id: 23, name: '당황', emoji: '😳', category: 'surprise', color: '#FFA502', desc: '어떻게 해야 할지 모르는 느낌', example: '갑작스런 질문을 받을 때' },
            { id: 24, name: '충격', emoji: '🤯', category: 'surprise', color: '#FFA502', desc: '매우 놀란 상태', example: '믿기 힘든 소식을 들을 때' },
            { id: 25, name: '감탄', emoji: '😍', category: 'surprise', color: '#FFA502', desc: '매우 좋아서 놀란 느낌', example: '멋진 것을 볼 때' },
            
            // 사랑 카테고리
            { id: 26, name: '사랑', emoji: '🥰', category: 'love', color: '#FD79A8', desc: '누군가를 아끼는 따뜻한 마음', example: '가족과 함께 있을 때' },
            { id: 27, name: '설렘', emoji: '💕', category: 'love', color: '#FD79A8', desc: '두근두근 기대되는 마음', example: '좋아하는 친구를 만날 때' },
            { id: 28, name: '애정', emoji: '💖', category: 'love', color: '#FD79A8', desc: '소중히 여기는 마음', example: '반려동물과 놀 때' },
            { id: 29, name: '친밀함', emoji: '🤝', category: 'love', color: '#FD79A8', desc: '가깝고 편안한 느낌', example: '베스트 프렌드와 있을 때' },
            { id: 30, name: '포근함', emoji: '🤗', category: 'love', color: '#FD79A8', desc: '따뜻하고 편안한 느낌', example: '엄마 품에 안길 때' }
        ];

        // 전역 변수
        let userProfile = null;
        let collectedCards = JSON.parse(localStorage.getItem('collectedEmotionCards') || '[]');
        let customCards = JSON.parse(localStorage.getItem('customEmotionCards') || '[]');
        let totalPoints = parseInt(localStorage.getItem('emotionCardPoints') || '0');
        let activityTimeline = JSON.parse(localStorage.getItem('emotionActivityTimeline') || '[]');
        let currentCategory = 'all';
        let selectedCustomEmoji = '❓';
        let selectedCustomColor = '#A29BFE';
        let selectedAvatar = '🦁';
        let currentGame = null;

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeUser();
            renderGallery();
            updateStats();
            updatePointsDisplay();
        });

        // 사용자 초기화
        function initializeUser() {
            const savedProfile = localStorage.getItem('emotionCardUserProfile');
            if (savedProfile) {
                userProfile = JSON.parse(savedProfile);
                displayUserProfile();
            } else {
                document.getElementById('profileModal').classList.remove('hidden');
            }
        }

        // 프로필 표시
        function displayUserProfile() {
            if (userProfile) {
                document.getElementById('userProfile').classList.remove('hidden');
                document.getElementById('userName').textContent = userProfile.name || '학생';
                document.getElementById('userAvatar').textContent = userProfile.avatar || '🦁';
            }
        }

        // 아바타 선택
        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.querySelectorAll('.avatar-selector').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // 프로필 저장
        function saveProfile() {
            const name = document.getElementById('profileNameInput').value.trim();
            const className = document.getElementById('profileClassInput').value.trim();
            
            if (!name) {
                alert('이름을 입력해주세요!');
                return;
            }
            
            userProfile = {
                name: name,
                className: className || '',
                avatar: selectedAvatar,
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('emotionCardUserProfile', JSON.stringify(userProfile));
            document.getElementById('profileModal').classList.add('hidden');
            displayUserProfile();
            
            // 활동 기록
            addActivity('profile_created', { name: name });
        }

        // 프로필 변경
        function changeProfile() {
            const savedProfile = localStorage.getItem('emotionCardUserProfile');
            if (savedProfile) {
                const profile = JSON.parse(savedProfile);
                document.getElementById('profileNameInput').value = profile.name || '';
                document.getElementById('profileClassInput').value = profile.className || '';
                selectedAvatar = profile.avatar || '🦁';
            }
            document.getElementById('profileModal').classList.remove('hidden');
        }

        // 활동 기록 추가
        function addActivity(type, data = {}) {
            const activity = {
                type: type,
                data: data,
                timestamp: new Date().toISOString()
            };
            
            // 오늘 날짜 찾기
            const today = new Date().toISOString().split('T')[0];
            let todayTimeline = activityTimeline.find(t => t.date === today);
            
            if (!todayTimeline) {
                todayTimeline = { date: today, activities: [] };
                activityTimeline.push(todayTimeline);
            }
            
            todayTimeline.activities.push(activity);
            localStorage.setItem('emotionActivityTimeline', JSON.stringify(activityTimeline));
        }

        // 학습 데이터 내보내기
        function exportLearningData() {
            const data = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                profile: userProfile || { name: '익명', avatar: '🦁' },
                statistics: {
                    totalPoints: totalPoints,
                    totalCards: emotionCards.length,
                    collectedCards: collectedCards.length,
                    customCards: customCards.length,
                    completionRate: Math.round((collectedCards.length / emotionCards.length) * 100),
                    favoriteCategory: getFavoriteCategory()
                },
                timeline: activityTimeline,
                collections: {
                    collectedCards: collectedCards,
                    customCards: customCards
                },
                achievements: getAchievements()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const fileName = `감정카드_학습기록_${data.profile.name}_${new Date().toISOString().split('T')[0]}.json`;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            
            showModal('📥', '다운로드 완료!', '학습 기록이 저장되었습니다.');
        }

        // 학습 데이터 가져오기
        function importLearningData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.version && data.collections) {
                        // 데이터 복원
                        if (data.profile) {
                            userProfile = data.profile;
                            localStorage.setItem('emotionCardUserProfile', JSON.stringify(userProfile));
                            displayUserProfile();
                        }
                        
                        if (data.collections.collectedCards) {
                            collectedCards = data.collections.collectedCards;
                            localStorage.setItem('collectedEmotionCards', JSON.stringify(collectedCards));
                        }
                        
                        if (data.collections.customCards) {
                            customCards = data.collections.customCards;
                            localStorage.setItem('customEmotionCards', JSON.stringify(customCards));
                        }
                        
                        if (data.statistics && data.statistics.totalPoints) {
                            totalPoints = data.statistics.totalPoints;
                            localStorage.setItem('emotionCardPoints', totalPoints);
                        }
                        
                        if (data.timeline) {
                            activityTimeline = data.timeline;
                            localStorage.setItem('emotionActivityTimeline', JSON.stringify(activityTimeline));
                        }
                        
                        renderGallery();
                        updateStats();
                        updatePointsDisplay();
                        
                        showModal('✅', '불러오기 완료!', '학습 기록을 성공적으로 불러왔습니다.');
                    } else {
                        alert('올바른 학습 기록 파일이 아닙니다.');
                    }
                } catch (error) {
                    alert('파일을 읽을 수 없습니다.');
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }

        // 시각적 리포트 생성
        function generateVisualReport() {
            const canvas = document.createElement('canvas');
            canvas.width = 1200;
            canvas.height = 1600;
            const ctx = canvas.getContext('2d');
            
            // 배경 그라데이션
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 흰색 카드 배경
            ctx.fillStyle = 'white';
            ctx.roundRect(50, 50, 1100, 1500, 30);
            ctx.fill();
            
            // 제목
            ctx.fillStyle = '#333';
            ctx.font = 'bold 60px Noto Sans KR';
            ctx.textAlign = 'center';
            ctx.fillText('🌈 나의 감정 카드 학습 리포트', 600, 150);
            
            // 학생 정보
            const userName = userProfile ? userProfile.name : '익명';
            const userAvatar = userProfile ? userProfile.avatar : '🦁';
            const userClass = userProfile ? userProfile.className : '';
            
            ctx.font = '40px Noto Sans KR';
            ctx.fillText(`${userAvatar} ${userName}`, 600, 230);
            if (userClass) {
                ctx.font = '30px Noto Sans KR';
                ctx.fillStyle = '#666';
                ctx.fillText(userClass, 600, 280);
            }
            
            // 통계 카드들
            const stats = [
                { label: '수집한 카드', value: collectedCards.length, icon: '📚', color: '#9333ea' },
                { label: '획득 포인트', value: totalPoints, icon: '🏆', color: '#3b82f6' },
                { label: '만든 카드', value: customCards.length, icon: '✨', color: '#f59e0b' },
                { label: '완성도', value: Math.round((collectedCards.length / emotionCards.length) * 100) + '%', icon: '🎯', color: '#10b981' }
            ];
            
            let x = 150;
            let y = 350;
            stats.forEach((stat, index) => {
                // 카드 배경
                ctx.fillStyle = stat.color;
                ctx.roundRect(x, y, 220, 150, 20);
                ctx.fill();
                
                // 아이콘과 텍스트
                ctx.fillStyle = 'white';
                ctx.font = '40px Noto Sans KR';
                ctx.textAlign = 'center';
                ctx.fillText(stat.icon, x + 110, y + 50);
                
                ctx.font = 'bold 36px Noto Sans KR';
                ctx.fillText(stat.value, x + 110, y + 95);
                
                ctx.font = '20px Noto Sans KR';
                ctx.fillText(stat.label, x + 110, y + 125);
                
                x += 250;
                if (index === 1) {
                    x = 150;
                    y += 180;
                }
            });
            
            // 수집한 카드 갤러리
            ctx.fillStyle = '#333';
            ctx.font = 'bold 36px Noto Sans KR';
            ctx.textAlign = 'left';
            ctx.fillText('📂 수집한 감정 카드', 100, 750);
            
            // 카드 미니 갤러리
            x = 100;
            y = 800;
            const displayCards = collectedCards.slice(0, 20);
            displayCards.forEach((cardId, index) => {
                const card = emotionCards.find(c => c.id === cardId);
                if (card) {
                    // 카드 배경
                    ctx.fillStyle = card.color;
                    ctx.roundRect(x, y, 90, 90, 15);
                    ctx.fill();
                    
                    // 이모지
                    ctx.font = '36px Noto Sans KR';
                    ctx.textAlign = 'center';
                    ctx.fillText(card.emoji, x + 45, y + 55);
                    
                    x += 100;
                    if ((index + 1) % 10 === 0) {
                        x = 100;
                        y += 100;
                    }
                }
            });
            
            // 생성 날짜
            ctx.fillStyle = '#666';
            ctx.font = '20px Noto Sans KR';
            ctx.textAlign = 'center';
            ctx.fillText(`생성일: ${new Date().toLocaleDateString('ko-KR')}`, 600, 1450);
            
            // 이미지로 다운로드
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const fileName = `감정카드_리포트_${userName}_${new Date().toISOString().split('T')[0]}.png`;
                a.download = fileName;
                a.click();
                URL.revokeObjectURL(url);
                
                showModal('🖼️', '리포트 생성 완료!', '이미지가 다운로드되었습니다.');
            });
        }

        // Canvas roundRect 폴리필
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, width, height, radius) {
                this.beginPath();
                this.moveTo(x + radius, y);
                this.lineTo(x + width - radius, y);
                this.quadraticCurveTo(x + width, y, x + width, y + radius);
                this.lineTo(x + width, y + height - radius);
                this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                this.lineTo(x + radius, y + height);
                this.quadraticCurveTo(x, y + height, x, y + height - radius);
                this.lineTo(x, y + radius);
                this.quadraticCurveTo(x, y, x + radius, y);
                this.closePath();
            };
        }

        // 즐겨찾는 카테고리 찾기
        function getFavoriteCategory() {
            const categoryCount = {};
            collectedCards.forEach(cardId => {
                const card = emotionCards.find(c => c.id === cardId);
                if (card) {
                    categoryCount[card.category] = (categoryCount[card.category] || 0) + 1;
                }
            });
            
            let maxCategory = 'happy';
            let maxCount = 0;
            for (const [category, count] of Object.entries(categoryCount)) {
                if (count > maxCount) {
                    maxCount = count;
                    maxCategory = category;
                }
            }
            return maxCategory;
        }

        // 업적 계산
        function getAchievements() {
            const achievements = [];
            
            if (collectedCards.length >= 1) {
                achievements.push({ id: 'first_card', name: '첫 카드 수집', icon: '🎯' });
            }
            if (collectedCards.length >= 10) {
                achievements.push({ id: 'collector_10', name: '10개 카드 수집', icon: '📚' });
            }
            if (collectedCards.length >= 20) {
                achievements.push({ id: 'collector_20', name: '20개 카드 수집', icon: '🏆' });
            }
            if (collectedCards.length === emotionCards.length) {
                achievements.push({ id: 'complete', name: '모든 카드 수집', icon: '👑' });
            }
            if (customCards.length >= 1) {
                achievements.push({ id: 'creator', name: '카드 제작자', icon: '✨' });
            }
            if (totalPoints >= 100) {
                achievements.push({ id: 'points_100', name: '100점 달성', icon: '💯' });
            }
            
            return achievements;
        }

        // 데이터 메뉴 표시
        function showDataMenu() {
            document.getElementById('dataMenuModal').classList.remove('hidden');
        }

        // 데이터 메뉴 닫기
        function closeDataMenu() {
            document.getElementById('dataMenuModal').classList.add('hidden');
        }

        // 포인트 표시 업데이트
        function updatePointsDisplay() {
            document.getElementById('totalPoints').textContent = totalPoints;
        }

        // 탭 전환
        function showTab(tab) {
            // 모든 탭 컨텐츠 숨기기
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // 모든 탭 버튼 스타일 초기화
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('hover:bg-purple-100');
            });
            
            // 선택된 탭 표시
            document.getElementById(tab + 'Content').classList.remove('hidden');
            document.getElementById(tab + 'Tab').classList.add('bg-purple-500', 'text-white');
            document.getElementById(tab + 'Tab').classList.remove('hover:bg-purple-100');
            
            // 탭별 초기화
            if (tab === 'collection') {
                renderCollection();
            }
        }

        // 갤러리 렌더링
        function renderGallery() {
            const grid = document.getElementById('emotionCardsGrid');
            const filteredCards = currentCategory === 'all' 
                ? emotionCards 
                : emotionCards.filter(card => card.category === currentCategory);
            
            grid.innerHTML = filteredCards.map(card => {
                const isCollected = collectedCards.includes(card.id);
                return `
                    <div class="emotion-card" onclick="flipCard(this, ${card.id})">
                        <div class="emotion-card-inner">
                            <div class="emotion-card-front" style="background: linear-gradient(135deg, ${card.color} 0%, ${card.color}dd 100%)">
                                <div class="text-5xl mb-3">${card.emoji}</div>
                                <h3 class="text-xl font-bold">${card.name}</h3>
                                ${isCollected ? '<span class="badge badge-collected mt-2">수집완료</span>' : '<span class="badge badge-new mt-2">NEW</span>'}
                            </div>
                            <div class="emotion-card-back">
                                <h3 class="text-xl font-bold mb-3 text-gray-800">${card.name}</h3>
                                <p class="text-sm mb-3 text-gray-600">${card.desc}</p>
                                <p class="text-sm text-gray-500">
                                    <strong>예시:</strong> ${card.example}
                                </p>
                                ${!isCollected ? '<button onclick="collectCard(event, ' + card.id + ')" class="mt-3 px-4 py-2 bg-purple-500 text-white rounded-full text-sm hover:bg-purple-600">수집하기</button>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 카드 뒤집기
        function flipCard(element, cardId) {
            element.classList.toggle('flipped');
        }

        // 카드 수집
        function collectCard(event, cardId) {
            event.stopPropagation();
            
            if (!collectedCards.includes(cardId)) {
                collectedCards.push(cardId);
                localStorage.setItem('collectedEmotionCards', JSON.stringify(collectedCards));
                
                // 포인트 추가
                totalPoints += 10;
                localStorage.setItem('emotionCardPoints', totalPoints);
                updatePointsDisplay();
                
                // 활동 기록
                const card = emotionCards.find(c => c.id === cardId);
                addActivity('card_collected', { cardId: cardId, cardName: card.name });
                
                // 애니메이션 효과
                const cardElement = event.target.closest('.emotion-card');
                cardElement.classList.add('card-collected');
                
                // 성공 메시지
                showModal('🎉', '카드 수집 완료!', '새로운 감정 카드를 수집했어요! +10점');
                createConfetti();
                
                // 갤러리 업데이트
                setTimeout(() => {
                    renderGallery();
                    updateStats();
                }, 1000);
            }
        }

        // 카테고리 필터
        function filterCategory(category) {
            currentCategory = category;
            renderGallery();
            
            // 버튼 스타일 업데이트
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-white', 'ring-opacity-50');
            });
            event.target.classList.add('ring-4', 'ring-white', 'ring-opacity-50');
        }

        // 게임 시작
        function startGame(gameType) {
            const gameArea = document.getElementById('gameArea');
            gameArea.classList.remove('hidden');
            
            if (gameType === 'match') {
                startMatchGame();
            } else if (gameType === 'quiz') {
                startQuizGame();
            } else if (gameType === 'memory') {
                startMemoryGame();
            }
            
            // 활동 기록
            addActivity('game_started', { gameType: gameType });
        }

        // 매칭 게임
        function startMatchGame() {
            const gameArea = document.getElementById('gameArea');
            const shuffledCards = [...emotionCards].sort(() => Math.random() - 0.5).slice(0, 6);
            
            gameArea.innerHTML = `
                <h3 class="text-xl font-bold mb-4 text-gray-800">이모지와 감정 단어를 연결하세요!</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-bold mb-2">이모지</h4>
                        <div class="space-y-2" id="emojiList">
                            ${shuffledCards.map(card => `
                                <div class="game-card bg-white p-4 rounded-lg text-center text-3xl" data-id="${card.id}">
                                    ${card.emoji}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold mb-2">감정 단어</h4>
                        <div class="space-y-2" id="wordList">
                            ${shuffledCards.sort(() => Math.random() - 0.5).map(card => `
                                <div class="game-card bg-white p-4 rounded-lg text-center font-bold" data-id="${card.id}">
                                    ${card.name}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <span class="text-gray-600">매칭: <span id="matchCount">0</span>/6</span>
                </div>
            `;
            
            let selectedEmoji = null;
            let selectedWord = null;
            let matches = 0;
            
            // 이벤트 리스너 추가
            document.querySelectorAll('#emojiList .game-card').forEach(card => {
                card.addEventListener('click', function() {
                    if (selectedEmoji) selectedEmoji.classList.remove('selected');
                    selectedEmoji = this;
                    this.classList.add('selected');
                    checkMatch();
                });
            });
            
            document.querySelectorAll('#wordList .game-card').forEach(card => {
                card.addEventListener('click', function() {
                    if (selectedWord) selectedWord.classList.remove('selected');
                    selectedWord = this;
                    this.classList.add('selected');
                    checkMatch();
                });
            });
            
            function checkMatch() {
                if (selectedEmoji && selectedWord) {
                    if (selectedEmoji.dataset.id === selectedWord.dataset.id) {
                        selectedEmoji.classList.add('matched');
                        selectedWord.classList.add('matched');
                        matches++;
                        document.getElementById('matchCount').textContent = matches;
                        
                        if (matches === 6) {
                            totalPoints += 30;
                            localStorage.setItem('emotionCardPoints', totalPoints);
                            updatePointsDisplay();
                            addActivity('game_completed', { gameType: 'match', score: 30 });
                            showModal('🏆', '게임 완료!', '모든 카드를 매칭했어요! +30점');
                        }
                        
                        selectedEmoji = null;
                        selectedWord = null;
                    } else {
                        setTimeout(() => {
                            selectedEmoji.classList.remove('selected');
                            selectedWord.classList.remove('selected');
                            selectedEmoji = null;
                            selectedWord = null;
                        }, 1000);
                    }
                }
            }
        }

        // 퀴즈 게임
        function startQuizGame() {
            const gameArea = document.getElementById('gameArea');
            const questions = [
                { 
                    question: '친구가 생일 선물을 줬을 때 느끼는 감정은?',
                    options: ['기쁨', '슬픔', '화남', '두려움'],
                    answer: '기쁨'
                },
                {
                    question: '시험을 망쳤을 때 느끼는 감정은?',
                    options: ['신남', '실망', '감사', '설렘'],
                    answer: '실망'
                },
                {
                    question: '어두운 방에 혼자 있을 때 느끼는 감정은?',
                    options: ['만족', '자랑스러움', '두려움', '애정'],
                    answer: '두려움'
                }
            ];
            
            let currentQuestion = 0;
            let score = 0;
            
            function showQuestion() {
                const q = questions[currentQuestion];
                gameArea.innerHTML = `
                    <h3 class="text-xl font-bold mb-4 text-gray-800">감정 퀴즈 (${currentQuestion + 1}/${questions.length})</h3>
                    <div class="bg-white rounded-2xl p-6">
                        <p class="text-lg mb-4">${q.question}</p>
                        <div class="grid grid-cols-2 gap-3">
                            ${q.options.map(option => `
                                <button onclick="checkAnswer('${option}')" class="px-4 py-3 bg-purple-100 hover:bg-purple-200 rounded-lg font-medium transition">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <span class="text-gray-600">점수: ${score}점</span>
                    </div>
                `;
            }
            
            window.checkAnswer = function(answer) {
                if (answer === questions[currentQuestion].answer) {
                    score += 10;
                    showModal('✅', '정답!', '잘했어요! +10점');
                } else {
                    showModal('❌', '틀렸어요', `정답은 "${questions[currentQuestion].answer}"입니다`);
                }
                
                currentQuestion++;
                if (currentQuestion < questions.length) {
                    setTimeout(showQuestion, 2000);
                } else {
                    totalPoints += score;
                    localStorage.setItem('emotionCardPoints', totalPoints);
                    updatePointsDisplay();
                    addActivity('game_completed', { gameType: 'quiz', score: score });
                    showModal('🎊', '퀴즈 완료!', `총 ${score}점을 획득했어요!`);
                }
            };
            
            showQuestion();
        }

        // 메모리 게임
        function startMemoryGame() {
            const gameArea = document.getElementById('gameArea');
            const memoryCards = emotionCards.slice(0, 6);
            const gameCards = [...memoryCards, ...memoryCards].sort(() => Math.random() - 0.5);
            
            gameArea.innerHTML = `
                <h3 class="text-xl font-bold mb-4 text-gray-800">같은 감정 카드를 찾아주세요!</h3>
                <div class="grid grid-cols-4 gap-3">
                    ${gameCards.map((card, index) => `
                        <div class="memory-card bg-purple-500 rounded-lg p-8 text-center cursor-pointer" data-id="${card.id}" data-index="${index}" onclick="flipMemoryCard(this)">
                            <div class="card-content hidden">
                                <div class="text-3xl">${card.emoji}</div>
                                <div class="text-sm font-bold text-white mt-1">${card.name}</div>
                            </div>
                            <div class="card-back text-3xl text-white">?</div>
                        </div>
                    `).join('')}
                </div>
                <div class="mt-4 text-center">
                    <span class="text-gray-600">찾은 쌍: <span id="pairCount">0</span>/6</span>
                </div>
            `;
            
            let flippedCards = [];
            let matchedPairs = 0;
            
            window.flipMemoryCard = function(card) {
                if (flippedCards.length < 2 && !card.classList.contains('matched')) {
                    card.querySelector('.card-content').classList.remove('hidden');
                    card.querySelector('.card-back').classList.add('hidden');
                    flippedCards.push(card);
                    
                    if (flippedCards.length === 2) {
                        if (flippedCards[0].dataset.id === flippedCards[1].dataset.id) {
                            flippedCards.forEach(c => c.classList.add('matched'));
                            matchedPairs++;
                            document.getElementById('pairCount').textContent = matchedPairs;
                            
                            if (matchedPairs === 6) {
                                totalPoints += 50;
                                localStorage.setItem('emotionCardPoints', totalPoints);
                                updatePointsDisplay();
                                addActivity('game_completed', { gameType: 'memory', score: 50 });
                                showModal('🏆', '게임 완료!', '모든 쌍을 찾았어요! +50점');
                            }
                            
                            flippedCards = [];
                        } else {
                            setTimeout(() => {
                                flippedCards.forEach(c => {
                                    c.querySelector('.card-content').classList.add('hidden');
                                    c.querySelector('.card-back').classList.remove('hidden');
                                });
                                flippedCards = [];
                            }, 1000);
                        }
                    }
                }
            };
        }

        // 커스텀 카드 관련 함수
        function selectEmoji(emoji) {
            selectedCustomEmoji = emoji;
            document.getElementById('selectedEmoji').textContent = emoji;
            document.getElementById('previewEmoji').textContent = emoji;
        }

        function selectColor(color) {
            selectedCustomColor = color;
            document.getElementById('previewCardFront').style.background = `linear-gradient(135deg, ${color} 0%, ${color}dd 100%)`;
        }

        // 미리보기 업데이트
        document.getElementById('customEmotionName').addEventListener('input', function() {
            document.getElementById('previewName').textContent = this.value || '감정 이름';
            document.getElementById('previewNameBack').textContent = this.value || '감정 이름';
        });

        document.getElementById('customEmotionDesc').addEventListener('input', function() {
            document.getElementById('previewDesc').textContent = this.value || '설명을 입력해주세요';
        });

        document.getElementById('customEmotionExample').addEventListener('input', function() {
            document.getElementById('previewExample').textContent = '예시: ' + (this.value || '-');
        });

        // 커스텀 카드 저장
        function saveCustomCard() {
            const name = document.getElementById('customEmotionName').value.trim();
            const desc = document.getElementById('customEmotionDesc').value.trim();
            const example = document.getElementById('customEmotionExample').value.trim();
            
            if (!name) {
                alert('감정 이름을 입력해주세요!');
                return;
            }
            
            if (!desc) {
                alert('설명을 입력해주세요!');
                return;
            }
            
            const newCard = {
                id: 'custom_' + Date.now(),
                name: name,
                emoji: selectedCustomEmoji,
                color: selectedCustomColor,
                desc: desc,
                example: example || '직접 경험해보세요',
                createdAt: new Date().toISOString()
            };
            
            customCards.push(newCard);
            localStorage.setItem('customEmotionCards', JSON.stringify(customCards));
            
            // 포인트 추가
            totalPoints += 20;
            localStorage.setItem('emotionCardPoints', totalPoints);
            updatePointsDisplay();
            
            // 활동 기록
            addActivity('card_created', { cardName: name });
            
            // 성공 메시지
            showModal('✨', '카드 생성 완료!', `"${name}" 카드를 만들었어요! +20점`);
            createConfetti();
            
            // 폼 초기화
            document.getElementById('customEmotionName').value = '';
            document.getElementById('customEmotionDesc').value = '';
            document.getElementById('customEmotionExample').value = '';
            selectedCustomEmoji = '❓';
            selectedCustomColor = '#A29BFE';
            document.getElementById('selectedEmoji').textContent = '❓';
            document.getElementById('previewEmoji').textContent = '❓';
            document.getElementById('previewName').textContent = '감정 이름';
            document.getElementById('previewNameBack').textContent = '감정 이름';
            document.getElementById('previewDesc').textContent = '설명을 입력해주세요';
            document.getElementById('previewExample').textContent = '예시: -';
            document.getElementById('previewCardFront').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            
            updateStats();
        }

        // 컬렉션 렌더링
        function renderCollection() {
            // 수집한 카드
            const collectionGrid = document.getElementById('collectionGrid');
            if (collectedCards.length > 0) {
                collectionGrid.innerHTML = collectedCards.map(cardId => {
                    const card = emotionCards.find(c => c.id === cardId);
                    return `
                        <div class="bg-white rounded-xl p-4 text-center shadow-lg">
                            <div class="text-3xl mb-2">${card.emoji}</div>
                            <div class="font-bold text-sm">${card.name}</div>
                        </div>
                    `;
                }).join('');
            } else {
                collectionGrid.innerHTML = '<p class="text-gray-500 col-span-4">아직 수집한 카드가 없어요</p>';
            }
            
            // 커스텀 카드
            const customGrid = document.getElementById('customCardsGrid');
            if (customCards.length > 0) {
                customGrid.innerHTML = customCards.map(card => `
                    <div class="bg-white rounded-xl p-4 text-center shadow-lg" style="background: linear-gradient(135deg, ${card.color}22 0%, ${card.color}44 100%)">
                        <div class="text-3xl mb-2">${card.emoji}</div>
                        <div class="font-bold text-sm">${card.name}</div>
                    </div>
                `).join('');
            } else {
                customGrid.innerHTML = '<p class="text-gray-500 col-span-4">아직 만든 카드가 없어요</p>';
            }
        }

        // 통계 업데이트
        function updateStats() {
            const total = emotionCards.length;
            const collected = collectedCards.length;
            const completion = Math.round((collected / total) * 100);
            
            document.getElementById('totalCards').textContent = total;
            document.getElementById('collectedCards').textContent = collected;
            document.getElementById('completionRate').textContent = completion + '%';
            document.getElementById('customCards').textContent = customCards.length;
            document.getElementById('progressText').textContent = `${collected}/${total}`;
            document.getElementById('progressBar').style.width = completion + '%';
        }

        // 모달 표시
        function showModal(icon, title, message) {
            const modal = document.getElementById('successModal');
            const content = document.getElementById('successModalContent');
            
            document.getElementById('modalIcon').textContent = icon;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.style.transform = 'scale(1)';
            }, 100);
            
            setTimeout(() => {
                closeModal();
            }, 2000);
        }

        // 모달 닫기
        function closeModal() {
            const modal = document.getElementById('successModal');
            const content = document.getElementById('successModalContent');
            content.style.transform = 'scale(0)';
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // 색종이 효과
        function createConfetti() {
            const colors = ['#FFD93D', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }
    </script>
</body>
</html>