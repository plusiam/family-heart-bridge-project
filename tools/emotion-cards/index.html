<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíé ÎîîÏßÄÌÑ∏ Í∞êÏ†ï Ïπ¥Îìú - Îã§ÏñëÌïú Í∞êÏ†ï ÏïåÏïÑÎ≥¥Í∏∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .title-font {
            font-family: 'Jua', sans-serif;
        }
        
        .emotion-card {
            perspective: 1000px;
            height: 280px;
            cursor: pointer;
        }
        
        .emotion-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .emotion-card.flipped .emotion-card-inner {
            transform: rotateY(180deg);
        }
        
        .emotion-card-front, .emotion-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .emotion-card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .emotion-card-back {
            background: white;
            transform: rotateY(180deg);
            color: #333;
        }
        
        .card-collected {
            animation: collect 0.5s ease;
        }
        
        @keyframes collect {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Í∞úÏÑ†Îêú Í≤åÏûÑ Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .game-card {
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .game-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .game-card.selected {
            border: 3px solid #10b981;
            background: #10b981 !important;
            color: white;
            transform: scale(0.95);
        }
        
        .game-card.matched {
            background: #10b981 !important;
            color: white;
            animation: matchPulse 0.5s ease;
        }
        
        .game-card.incorrect {
            animation: shake 0.5s ease;
            background: #ef4444 !important;
            color: white;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        @keyframes matchPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* ÏÉÅÌô© Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .situation-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px;
            color: white;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .emotion-choice-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .emotion-choice-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #9333ea;
        }
        
        .emotion-choice-card.selected {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            color: white;
            transform: scale(0.95);
        }
        
        /* ÎπôÍ≥† Ïä§ÌÉÄÏùº */
        .bingo-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 10px;
        }
        
        .bingo-cell:hover:not(.checked) {
            background: #f3f4f6;
            transform: scale(1.05);
        }
        
        .bingo-cell.checked {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            color: white;
            animation: checkAnimation 0.5s ease;
        }
        
        .bingo-cell.center {
            background: linear-gradient(135deg, #9333ea 0%, #c084fc 100%);
            color: white;
            cursor: default;
        }
        
        @keyframes checkAnimation {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .star-animation {
            animation: starSpin 2s linear infinite;
        }
        
        @keyframes starSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .badge-new {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .badge-collected {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        
        .emotion-category-happy { background: linear-gradient(135deg, #FFD93D 0%, #FFB347 100%); }
        .emotion-category-sad { background: linear-gradient(135deg, #4682B4 0%, #1E90FF 100%); }
        .emotion-category-angry { background: linear-gradient(135deg, #FF6B6B 0%, #FF4757 100%); }
        .emotion-category-fear { background: linear-gradient(135deg, #6C5CE7 0%, #A29BFE 100%); }
        .emotion-category-surprise { background: linear-gradient(135deg, #FFA502 0%, #FF6348 100%); }
        .emotion-category-love { background: linear-gradient(135deg, #FD79A8 0%, #FDCB6E 100%); }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            animation: confetti-fall 3s linear;
            z-index: 1000;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            transition: width 0.5s ease;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
        }
        
        .avatar-selector {
            display: inline-block;
            padding: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .avatar-selector:hover {
            background: rgba(147, 51, 234, 0.1);
            transform: scale(1.1);
        }
        
        .avatar-selector.selected {
            background: rgba(147, 51, 234, 0.2);
            border: 2px solid #9333ea;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
    <!-- Ìó§Îçî -->
    <header class="glass-effect shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-4xl float-animation">üíé</span>
                    <div>
                        <h1 class="title-font text-2xl md:text-3xl text-gray-800">ÎîîÏßÄÌÑ∏ Í∞êÏ†ï Ïπ¥Îìú</h1>
                        <p class="text-sm text-gray-600">Îã§ÏñëÌïú Í∞êÏ†ïÏùÑ Î∞∞Ïö∞Í≥† Ïù¥Ìï¥Ìï¥Ïöî</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <!-- ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑ ÌëúÏãú -->
                    <div id="userProfile" class="hidden user-profile">
                        <span id="userAvatar" class="text-2xl">ü¶Å</span>
                        <span id="userName" class="font-bold">ÌïôÏÉù</span>
                    </div>
                    <div class="bg-purple-100 px-4 py-2 rounded-full">
                        <span class="text-purple-700 font-bold">
                            üèÜ <span id="totalPoints">0</span>Ï†ê
                        </span>
                    </div>
                    <button onclick="showDataMenu()" class="px-4 py-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition">
                        üíæ Îç∞Ïù¥ÌÑ∞
                    </button>
                    <button onclick="window.location.href='../../'" class="px-4 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                        üè† Î©îÏù∏ÏúºÎ°ú
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <div class="flex justify-center mb-8">
            <div class="glass-effect rounded-full p-1 inline-flex">
                <button onclick="showTab('gallery')" id="galleryTab" class="tab-btn px-6 py-2 rounded-full bg-purple-500 text-white transition">
                    üìö Í∞êÏ†ï Í∞§Îü¨Î¶¨
                </button>
                <button onclick="showTab('game')" id="gameTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    üéÆ Í∞êÏ†ï Í≤åÏûÑ
                </button>
                <button onclick="showTab('create')" id="createTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    ‚úèÔ∏è Ïπ¥Îìú ÎßåÎì§Í∏∞
                </button>
                <button onclick="showTab('collection')" id="collectionTab" class="tab-btn px-6 py-2 rounded-full hover:bg-purple-100 transition">
                    üèÜ ÎÇòÏùò Ïª¨Î†âÏÖò
                </button>
            </div>
        </div>

        <!-- Í∞êÏ†ï Í∞§Îü¨Î¶¨ ÌÉ≠ -->
        <div id="galleryContent" class="tab-content">
            <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ -->
            <div class="glass-effect rounded-3xl p-6 mb-8">
                <h3 class="font-bold text-lg mb-4 text-gray-800">üé® Í∞êÏ†ï Ïπ¥ÌÖåÍ≥†Î¶¨</h3>
                <div class="flex flex-wrap gap-3 justify-center">
                    <button onclick="filterCategory('all')" class="category-btn px-4 py-2 bg-purple-500 text-white rounded-full">
                        Ï†ÑÏ≤¥
                    </button>
                    <button onclick="filterCategory('happy')" class="category-btn px-4 py-2 bg-yellow-400 text-white rounded-full">
                        üòä Í∏∞ÏÅ®
                    </button>
                    <button onclick="filterCategory('sad')" class="category-btn px-4 py-2 bg-blue-400 text-white rounded-full">
                        üò¢ Ïä¨Ìîî
                    </button>
                    <button onclick="filterCategory('angry')" class="category-btn px-4 py-2 bg-red-400 text-white rounded-full">
                        üò† ÌôîÎÇ®
                    </button>
                    <button onclick="filterCategory('fear')" class="category-btn px-4 py-2 bg-purple-400 text-white rounded-full">
                        üò® ÎëêÎ†§ÏõÄ
                    </button>
                    <button onclick="filterCategory('surprise')" class="category-btn px-4 py-2 bg-orange-400 text-white rounded-full">
                        üò≤ ÎÜÄÎûå
                    </button>
                    <button onclick="filterCategory('love')" class="category-btn px-4 py-2 bg-pink-400 text-white rounded-full">
                        ü•∞ ÏÇ¨Îûë
                    </button>
                </div>
            </div>

            <!-- Í∞êÏ†ï Ïπ¥Îìú Í∑∏Î¶¨Îìú -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="emotionCardsGrid">
                <!-- Ïπ¥ÎìúÎì§Ïù¥ JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ±Îê® -->
            </div>
        </div>

        <!-- Í∞êÏ†ï Í≤åÏûÑ ÌÉ≠ -->
        <div id="gameContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">üéÆ Í∞êÏ†ï ÎßûÏ∂îÍ∏∞ Í≤åÏûÑ</h2>
                
                <!-- Í≤åÏûÑ ÏÑ†ÌÉù -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-purple-400 to-pink-400 rounded-2xl p-6 text-white text-center cursor-pointer hover:scale-105 transition" onclick="startGame('situation')">
                        <div class="text-4xl mb-2">üìñ</div>
                        <h3 class="font-bold text-lg">ÏÉÅÌô© Í∞êÏ†ï Ï∞æÍ∏∞</h3>
                        <p class="text-sm mt-2">ÏÉÅÌô©ÏùÑ Î≥¥Í≥† Í∞êÏ†ï ÎßûÏ∂îÍ∏∞</p>
                    </div>
                    <div class="bg-gradient-to-r from-blue-400 to-cyan-400 rounded-2xl p-6 text-white text-center cursor-pointer hover:scale-105 transition" onclick="startGame('detective')">
                        <div class="text-4xl mb-2">üîç</div>
                        <h3 class="font-bold text-lg">Í∞êÏ†ï ÌÉêÏ†ï</h3>
                        <p class="text-sm mt-2">Îã®ÏÑúÎ•º Î≥¥Í≥† Í∞êÏ†ï Ï∂îÎ¶¨</p>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-2xl p-6 text-white text-center cursor-pointer hover:scale-105 transition" onclick="startGame('bingo')">
                        <div class="text-4xl mb-2">üéØ</div>
                        <h3 class="font-bold text-lg">Í∞êÏ†ï ÎπôÍ≥†</h3>
                        <p class="text-sm mt-2">Ïò§Îäò ÎäêÎÇÄ Í∞êÏ†ïÏúºÎ°ú ÎπôÍ≥†</p>
                    </div>
                    <div class="bg-gradient-to-r from-green-400 to-emerald-400 rounded-2xl p-6 text-white text-center cursor-pointer hover:scale-105 transition" onclick="startGame('memory')">
                        <div class="text-4xl mb-2">üß©</div>
                        <h3 class="font-bold text-lg">Í∞êÏ†ï Î©îÎ™®Î¶¨</h3>
                        <p class="text-sm mt-2">Í∞ôÏùÄ Í∞êÏ†ï Ïπ¥Îìú Ï∞æÍ∏∞</p>
                    </div>
                </div>

                <!-- Í≤åÏûÑ ÏòÅÏó≠ -->
                <div id="gameArea" class="hidden">
                    <!-- Í≤åÏûÑÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê® -->
                </div>
            </div>
        </div>

        <!-- Ïπ¥Îìú ÎßåÎì§Í∏∞ ÌÉ≠ -->
        <div id="createContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">‚úèÔ∏è ÎÇòÎßåÏùò Í∞êÏ†ï Ïπ¥Îìú ÎßåÎì§Í∏∞</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- ÏûÖÎ†• Ìèº -->
                    <div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">Í∞êÏ†ï Ïù¥Î¶Ñ</label>
                            <input type="text" id="customEmotionName" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="Ïòà: ÏÑ§Î†ò">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">Ïù¥Î™®ÏßÄ ÏÑ†ÌÉù</label>
                            <div class="grid grid-cols-6 gap-2">
                                <button onclick="selectEmoji('üòä')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üòä</button>
                                <button onclick="selectEmoji('üòÉ')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üòÉ</button>
                                <button onclick="selectEmoji('üòç')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üòç</button>
                                <button onclick="selectEmoji('ü§ó')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">ü§ó</button>
                                <button onclick="selectEmoji('üòé')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üòé</button>
                                <button onclick="selectEmoji('üò¥')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üò¥</button>
                                <button onclick="selectEmoji('üòÆ')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üòÆ</button>
                                <button onclick="selectEmoji('üòØ')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üòØ</button>
                                <button onclick="selectEmoji('üò¢')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üò¢</button>
                                <button onclick="selectEmoji('üò≠')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üò≠</button>
                                <button onclick="selectEmoji('üò°')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">üò°</button>
                                <button onclick="selectEmoji('ü§Ø')" class="emoji-btn text-3xl p-2 hover:bg-purple-100 rounded">ü§Ø</button>
                            </div>
                            <div class="mt-2">
                                <span class="text-sm text-gray-600">ÏÑ†ÌÉùÎêú Ïù¥Î™®ÏßÄ: </span>
                                <span id="selectedEmoji" class="text-3xl">‚ùì</span>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">ÏÉâÏÉÅ ÏÑ†ÌÉù</label>
                            <div class="flex gap-2">
                                <button onclick="selectColor('#FFD93D')" class="w-10 h-10 rounded" style="background: #FFD93D"></button>
                                <button onclick="selectColor('#FF6B6B')" class="w-10 h-10 rounded" style="background: #FF6B6B"></button>
                                <button onclick="selectColor('#4ECDC4')" class="w-10 h-10 rounded" style="background: #4ECDC4"></button>
                                <button onclick="selectColor('#A29BFE')" class="w-10 h-10 rounded" style="background: #A29BFE"></button>
                                <button onclick="selectColor('#FD79A8')" class="w-10 h-10 rounded" style="background: #FD79A8"></button>
                                <button onclick="selectColor('#6C5CE7')" class="w-10 h-10 rounded" style="background: #6C5CE7"></button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">ÏÑ§Î™Ö</label>
                            <textarea id="customEmotionDesc" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none resize-none" rows="3" placeholder="Ïù¥ Í∞êÏ†ïÏùÄ Ïñ∏Ï†ú ÎäêÎÅºÎÇòÏöî?"></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 font-bold mb-2">ÏòàÏãú ÏÉÅÌô©</label>
                            <input type="text" id="customEmotionExample" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="Ïòà: ÏÑ†Î¨ºÏùÑ Î∞õÏïòÏùÑ Îïå">
                        </div>
                        
                        <button onclick="saveCustomCard()" class="w-full px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-full hover:scale-105 transition">
                            üíæ Ïπ¥Îìú Ï†ÄÏû•ÌïòÍ∏∞
                        </button>
                    </div>
                    
                    <!-- ÎØ∏Î¶¨Î≥¥Í∏∞ -->
                    <div>
                        <h3 class="font-bold text-lg mb-4 text-gray-700">ÎØ∏Î¶¨Î≥¥Í∏∞</h3>
                        <div class="emotion-card">
                            <div class="emotion-card-inner">
                                <div class="emotion-card-front" id="previewCardFront">
                                    <div class="text-6xl mb-4" id="previewEmoji">‚ùì</div>
                                    <h3 class="text-2xl font-bold" id="previewName">Í∞êÏ†ï Ïù¥Î¶Ñ</h3>
                                </div>
                                <div class="emotion-card-back">
                                    <h3 class="text-xl font-bold mb-3" id="previewNameBack">Í∞êÏ†ï Ïù¥Î¶Ñ</h3>
                                    <p class="text-sm mb-3" id="previewDesc">ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</p>
                                    <p class="text-sm text-gray-600" id="previewExample">ÏòàÏãú: -</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÎÇòÏùò Ïª¨Î†âÏÖò ÌÉ≠ -->
        <div id="collectionContent" class="tab-content hidden">
            <div class="glass-effect rounded-3xl p-8">
                <h2 class="title-font text-2xl text-center mb-6 text-gray-800">üèÜ ÎÇòÏùò Í∞êÏ†ï Ïπ¥Îìú Ïª¨Î†âÏÖò</h2>
                
                <!-- Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ Î≤ÑÌäº -->
                <div class="flex justify-center gap-3 mb-6">
                    <button onclick="exportLearningData()" class="px-4 py-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition">
                        üì• ÌïôÏäµ Í∏∞Î°ù Îã§Ïö¥Î°úÎìú (JSON)
                    </button>
                    <button onclick="generateVisualReport()" class="px-4 py-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition">
                        üñºÔ∏è ÏÑ±Í≥º Î¶¨Ìè¨Ìä∏ Ïù¥ÎØ∏ÏßÄ
                    </button>
                    <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                        üì§ ÌïôÏäµ Í∏∞Î°ù Î∂àÎü¨Ïò§Í∏∞
                    </button>
                    <input type="file" id="importFile" hidden accept=".json" onchange="importLearningData(this.files[0])">
                </div>
                
                <!-- ÌÜµÍ≥Ñ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-purple-400 to-pink-400 rounded-2xl p-4 text-white text-center">
                        <div class="text-3xl mb-1">üìö</div>
                        <div class="text-2xl font-bold" id="totalCards">0</div>
                        <div class="text-sm">Ï†ÑÏ≤¥ Ïπ¥Îìú</div>
                    </div>
                    <div class="bg-gradient-to-r from-blue-400 to-cyan-400 rounded-2xl p-4 text-white text-center">
                        <div class="text-3xl mb-1">‚úÖ</div>
                        <div class="text-2xl font-bold" id="collectedCards">0</div>
                        <div class="text-sm">ÏàòÏßëÌïú Ïπ¥Îìú</div>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-2xl p-4 text-white text-center">
                        <div class="text-3xl mb-1">üéØ</div>
                        <div class="text-2xl font-bold" id="completionRate">0%</div>
                        <div class="text-sm">ÏôÑÏÑ±ÎèÑ</div>
                    </div>
                    <div class="bg-gradient-to-r from-green-400 to-emerald-400 rounded-2xl p-4 text-white text-center">
                        <div class="text-3xl mb-1">‚úèÔ∏è</div>
                        <div class="text-2xl font-bold" id="customCards">0</div>
                        <div class="text-sm">ÎÇ¥Í∞Ä ÎßåÎì† Ïπ¥Îìú</div>
                    </div>
                </div>
                
                <!-- ÏßÑÌñâÎ•† Î∞î -->
                <div class="mb-8">
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-700 font-medium">Ïª¨Î†âÏÖò ÏßÑÌñâÎ•†</span>
                        <span class="text-gray-700 font-medium" id="progressText">0/30</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- ÏàòÏßëÌïú Ïπ¥Îìú Î™©Î°ù -->
                <div>
                    <h3 class="font-bold text-lg mb-4 text-gray-700">üìÇ ÏàòÏßëÌïú Ïπ¥Îìú</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="collectionGrid">
                        <!-- ÏàòÏßëÌïú Ïπ¥ÎìúÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê® -->
                    </div>
                </div>
                
                <!-- ÎÇ¥Í∞Ä ÎßåÎì† Ïπ¥Îìú Î™©Î°ù -->
                <div class="mt-8">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">‚ú® ÎÇ¥Í∞Ä ÎßåÎì† Ïπ¥Îìú</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="customCardsGrid">
                        <!-- Ïª§Ïä§ÌÖÄ Ïπ¥ÎìúÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê® -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑ Î™®Îã¨ -->
    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl p-8 max-w-md mx-4">
            <h3 class="text-2xl font-bold mb-4 text-center">üëã ÏïàÎÖïÌïòÏÑ∏Ïöî!</h3>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</label>
                <input type="text" id="profileNameInput" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="Ïòà: ÍπÄÌïôÏÉù">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">ÌïôÍ∏â</label>
                <input type="text" id="profileClassInput" class="w-full px-4 py-2 rounded-lg border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="Ïòà: 3ÌïôÎÖÑ 2Î∞ò">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">ÏïÑÎ∞îÌÉÄ ÏÑ†ÌÉù</label>
                <div class="grid grid-cols-6 gap-2">
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('ü¶Å')">ü¶Å</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('üê∂')">üê∂</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('üê±')">üê±</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('üê∞')">üê∞</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('üêº')">üêº</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('ü¶ä')">ü¶ä</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('üê∏')">üê∏</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('üêß')">üêß</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('ü¶ã')">ü¶ã</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('üåü')">üåü</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('üåà')">üåà</span>
                    <span class="avatar-selector text-3xl" onclick="selectAvatar('üéà')">üéà</span>
                </div>
            </div>
            <button onclick="saveProfile()" class="w-full px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-full hover:scale-105 transition">
                ÏãúÏûëÌïòÍ∏∞
            </button>
        </div>
    </div>

    <!-- Îç∞Ïù¥ÌÑ∞ Î©îÎâ¥ Î™®Îã¨ -->
    <div id="dataMenuModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl p-8 max-w-md mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center">üíæ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h3>
            <div class="space-y-3">
                <button onclick="exportLearningData(); closeDataMenu();" class="w-full px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                    üì• ÌïôÏäµ Í∏∞Î°ù Îã§Ïö¥Î°úÎìú (JSON)
                </button>
                <button onclick="generateVisualReport(); closeDataMenu();" class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                    üñºÔ∏è ÏÑ±Í≥º Î¶¨Ìè¨Ìä∏ Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú
                </button>
                <button onclick="document.getElementById('importFileModal').click(); closeDataMenu();" class="w-full px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition">
                    üì§ ÌïôÏäµ Í∏∞Î°ù Î∂àÎü¨Ïò§Í∏∞
                </button>
                <input type="file" id="importFileModal" hidden accept=".json" onchange="importLearningData(this.files[0])">
                <button onclick="changeProfile(); closeDataMenu();" class="w-full px-4 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition">
                    üë§ ÌîÑÎ°úÌïÑ Î≥ÄÍ≤Ω
                </button>
                <button onclick="closeDataMenu()" class="w-full px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                    Îã´Í∏∞
                </button>
            </div>
        </div>
    </div>

    <!-- ÏÑ±Í≥µ Î™®Îã¨ -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl p-8 max-w-sm mx-4 transform scale-0 transition-transform" id="successModalContent">
            <div class="text-center">
                <div class="text-6xl mb-4" id="modalIcon">üéâ</div>
                <h3 class="text-2xl font-bold mb-2" id="modalTitle">ÏÑ±Í≥µ!</h3>
                <p class="text-gray-600 mb-4" id="modalMessage">ÏûòÌñàÏñ¥Ïöî!</p>
                <button onclick="closeModal()" class="px-6 py-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition">
                    ÌôïÏù∏
                </button>
            </div>
        </div>
    </div>

    <script>
        // Í∞êÏ†ï Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞
        const emotionCards = [
            // Í∏∞ÏÅ® Ïπ¥ÌÖåÍ≥†Î¶¨
            { id: 1, name: 'Í∏∞ÏÅ®', emoji: 'üòä', category: 'happy', color: '#FFD93D', desc: 'ÎßàÏùåÏù¥ Ï¶êÍ≤ÅÍ≥† ÌñâÎ≥µÌïú ÎäêÎÇå', example: 'ÏπúÍµ¨ÏôÄ ÎÜÄ Îïå' },
            { id: 2, name: 'Ïã†ÎÇ®', emoji: 'ü§ó', category: 'happy', color: '#FFD93D', desc: 'ÏóêÎÑàÏßÄÍ∞Ä ÎÑòÏπòÍ≥† Îì§Îú¨ Í∏∞Î∂Ñ', example: 'ÏÜåÌíç Í∞ÄÎäî ÎÇ†' },
            { id: 3, name: 'ÎßåÏ°±', emoji: 'üòå', category: 'happy', color: '#FFD93D', desc: 'ÎßàÏùåÏù¥ Ìé∏ÏïàÌïòÍ≥† Ï∂©Î∂ÑÌïú ÎäêÎÇå', example: 'ÎßõÏûàÎäî Í±∏ Î®πÏóàÏùÑ Îïå' },
            { id: 4, name: 'ÏûêÎûëÏä§Îü¨ÏõÄ', emoji: 'üòé', category: 'happy', color: '#FFD93D', desc: 'Ïä§Ïä§Î°úÍ∞Ä ÎåÄÍ≤¨Ìïú ÎäêÎÇå', example: 'ÏãúÌóòÏùÑ Ïûò Î¥§ÏùÑ Îïå' },
            { id: 5, name: 'Í∞êÏÇ¨', emoji: 'üôè', category: 'happy', color: '#FFD93D', desc: 'Í≥†ÎßàÏö¥ ÎßàÏùå', example: 'ÎèÑÏõÄÏùÑ Î∞õÏïòÏùÑ Îïå' },
            
            // Ïä¨Ìîî Ïπ¥ÌÖåÍ≥†Î¶¨
            { id: 6, name: 'Ïä¨Ìîî', emoji: 'üò¢', category: 'sad', color: '#4682B4', desc: 'ÎßàÏùåÏù¥ ÏïÑÌîÑÍ≥† ÎààÎ¨ºÏù¥ ÎÇòÎäî ÎäêÎÇå', example: 'ÏπúÍµ¨ÏôÄ Ìó§Ïñ¥Ïßà Îïå' },
            { id: 7, name: 'Ïô∏Î°úÏõÄ', emoji: 'üòî', category: 'sad', color: '#4682B4', desc: 'ÌòºÏûêÏù∏ Í≤É Í∞ôÏùÄ ÎäêÎÇå', example: 'ÏπúÍµ¨Îì§Ïù¥ ÏóÜÏùÑ Îïå' },
            { id: 8, name: 'Ïã§Îßù', emoji: 'üòû', category: 'sad', color: '#4682B4', desc: 'Í∏∞ÎåÄÏôÄ Îã¨ÎùºÏÑú ÏÜçÏÉÅÌïú ÎäêÎÇå', example: 'ÏïΩÏÜçÏù¥ Ï∑®ÏÜåÎêêÏùÑ Îïå' },
            { id: 9, name: 'Í∑∏Î¶¨ÏõÄ', emoji: 'ü•∫', category: 'sad', color: '#4682B4', desc: 'Î≥¥Í≥† Ïã∂ÏùÄ ÎßàÏùå', example: 'Í∞ÄÏ°±Ïù¥ Î≥¥Í≥† Ïã∂ÏùÑ Îïå' },
            { id: 10, name: 'ÌõÑÌöå', emoji: 'üòì', category: 'sad', color: '#4682B4', desc: 'ÎêòÎèåÎ¶¨Í≥† Ïã∂ÏùÄ ÎßàÏùå', example: 'Ïã§ÏàòÌñàÏùÑ Îïå' },
            
            // ÌôîÎÇ® Ïπ¥ÌÖåÍ≥†Î¶¨
            { id: 11, name: 'ÌôîÎÇ®', emoji: 'üò†', category: 'angry', color: '#FF6B6B', desc: 'ÏÜçÏù¥ Î∂ÄÍ∏ÄÎ∂ÄÍ∏Ä ÎÅìÎäî ÎäêÎÇå', example: 'Î∂àÍ≥µÌèâÌï† Îïå' },
            { id: 12, name: 'ÏßúÏ¶ù', emoji: 'üò§', category: 'angry', color: '#FF6B6B', desc: 'Ïã†Í≤ΩÏù¥ Í±∞Ïä¨Î¶¨Îäî ÎäêÎÇå', example: 'Î∞©Ìï¥Î∞õÏùÑ Îïå' },
            { id: 13, name: 'ÎãµÎãµÌï®', emoji: 'üò£', category: 'angry', color: '#FF6B6B', desc: 'ÎßâÌûå Í≤É Í∞ôÏùÄ ÎäêÎÇå', example: 'Ïù¥Ìï¥Î∞õÏßÄ Î™ªÌï† Îïå' },
            { id: 14, name: 'ÏñµÏö∏Ìï®', emoji: 'üòñ', category: 'angry', color: '#FF6B6B', desc: 'Í≥µÌèâÌïòÏßÄ ÏïäÎã§Í≥† ÎäêÎÅºÎäî ÎßàÏùå', example: 'Ïò§Ìï¥Î∞õÏùÑ Îïå' },
            { id: 15, name: 'Î∂ÑÎÖ∏', emoji: 'ü§¨', category: 'angry', color: '#FF6B6B', desc: 'Îß§Ïö∞ ÌôîÍ∞Ä ÎÇú ÏÉÅÌÉú', example: 'Í¥¥Î°≠ÌûòÏùÑ ÎãπÌï† Îïå' },
            
            // ÎëêÎ†§ÏõÄ Ïπ¥ÌÖåÍ≥†Î¶¨
            { id: 16, name: 'ÎëêÎ†§ÏõÄ', emoji: 'üò®', category: 'fear', color: '#6C5CE7', desc: 'Î¨¥ÏÑúÏö¥ ÎäêÎÇå', example: 'Ïñ¥Îë† ÏÜçÏóê ÏûàÏùÑ Îïå' },
            { id: 17, name: 'Í±±Ï†ï', emoji: 'üòü', category: 'fear', color: '#6C5CE7', desc: 'ÎÇòÏÅú ÏùºÏù¥ ÏÉùÍ∏∏ÍπåÎ¥ê Î∂àÏïàÌïú ÎßàÏùå', example: 'ÏãúÌóò Î≥¥Í∏∞ Ï†Ñ' },
            { id: 18, name: 'Í∏¥Ïû•', emoji: 'üò∞', category: 'fear', color: '#6C5CE7', desc: 'ÎßàÏùåÏù¥ Ï°∞ÎßàÏ°∞ÎßàÌïú ÎäêÎÇå', example: 'Î∞úÌëúÌï† Îïå' },
            { id: 19, name: 'Î∂àÏïà', emoji: 'üò•', category: 'fear', color: '#6C5CE7', desc: 'ÎßàÏùåÏù¥ Ìé∏ÌïòÏßÄ ÏïäÏùÄ ÏÉÅÌÉú', example: 'ÏÉàÎ°úÏö¥ Í≥≥Ïóê Í∞à Îïå' },
            { id: 20, name: 'Ï¥àÏ°∞Ìï®', emoji: 'üò¨', category: 'fear', color: '#6C5CE7', desc: 'Îπ®Î¶¨ Ìï¥Ïïº Ìï† Í≤É Í∞ôÏùÄ ÎäêÎÇå', example: 'ÏãúÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï† Îïå' },
            
            // ÎÜÄÎûå Ïπ¥ÌÖåÍ≥†Î¶¨
            { id: 21, name: 'ÎÜÄÎûå', emoji: 'üò≤', category: 'surprise', color: '#FFA502', desc: 'ÏòàÏÉÅÌïòÏßÄ Î™ªÌïú ÏùºÏóê ÍπúÏßù ÎÜÄÎûÄ ÎäêÎÇå', example: 'ÍπúÏßù ÏÑ†Î¨º Î∞õÏùÑ Îïå' },
            { id: 22, name: 'Ïã†Í∏∞Ìï®', emoji: 'ü§î', category: 'surprise', color: '#FFA502', desc: 'Ï≤òÏùå Î≥¥Îäî Í≤ÉÏóê ÎåÄÌïú Ìò∏Í∏∞Ïã¨', example: 'ÏÉàÎ°úÏö¥ Í≤ÉÏùÑ Î∞úÍ≤¨Ìï† Îïå' },
            { id: 23, name: 'ÎãπÌô©', emoji: 'üò≥', category: 'surprise', color: '#FFA502', desc: 'Ïñ¥ÎñªÍ≤å Ìï¥Ïïº Ìï†ÏßÄ Î™®Î•¥Îäî ÎäêÎÇå', example: 'Í∞ëÏûëÏä§Îü∞ ÏßàÎ¨∏ÏùÑ Î∞õÏùÑ Îïå' },
            { id: 24, name: 'Ï∂©Í≤©', emoji: 'ü§Ø', category: 'surprise', color: '#FFA502', desc: 'Îß§Ïö∞ ÎÜÄÎûÄ ÏÉÅÌÉú', example: 'ÎØøÍ∏∞ ÌûòÎì† ÏÜåÏãùÏùÑ Îì§ÏùÑ Îïå' },
            { id: 25, name: 'Í∞êÌÉÑ', emoji: 'üòç', category: 'surprise', color: '#FFA502', desc: 'Îß§Ïö∞ Ï¢ãÏïÑÏÑú ÎÜÄÎûÄ ÎäêÎÇå', example: 'Î©ãÏßÑ Í≤ÉÏùÑ Î≥º Îïå' },
            
            // ÏÇ¨Îûë Ïπ¥ÌÖåÍ≥†Î¶¨
            { id: 26, name: 'ÏÇ¨Îûë', emoji: 'ü•∞', category: 'love', color: '#FD79A8', desc: 'ÎàÑÍµ∞Í∞ÄÎ•º ÏïÑÎÅºÎäî Îî∞ÎúªÌïú ÎßàÏùå', example: 'Í∞ÄÏ°±Í≥º Ìï®Íªò ÏûàÏùÑ Îïå' },
            { id: 27, name: 'ÏÑ§Î†ò', emoji: 'üíï', category: 'love', color: '#FD79A8', desc: 'ÎëêÍ∑ºÎëêÍ∑º Í∏∞ÎåÄÎêòÎäî ÎßàÏùå', example: 'Ï¢ãÏïÑÌïòÎäî ÏπúÍµ¨Î•º ÎßåÎÇ† Îïå' },
            { id: 28, name: 'Ïï†Ï†ï', emoji: 'üíñ', category: 'love', color: '#FD79A8', desc: 'ÏÜåÏ§ëÌûà Ïó¨Í∏∞Îäî ÎßàÏùå', example: 'Î∞òÎ†§ÎèôÎ¨ºÍ≥º ÎÜÄ Îïå' },
            { id: 29, name: 'ÏπúÎ∞ÄÌï®', emoji: 'ü§ù', category: 'love', color: '#FD79A8', desc: 'Í∞ÄÍπùÍ≥† Ìé∏ÏïàÌïú ÎäêÎÇå', example: 'Î≤†Ïä§Ìä∏ ÌîÑÎ†åÎìúÏôÄ ÏûàÏùÑ Îïå' },
            { id: 30, name: 'Ìè¨Í∑ºÌï®', emoji: 'ü§ó', category: 'love', color: '#FD79A8', desc: 'Îî∞ÎúªÌïòÍ≥† Ìé∏ÏïàÌïú ÎäêÎÇå', example: 'ÏóÑÎßà ÌíàÏóê ÏïàÍ∏∏ Îïå' }
        ];

        // ÏÉÅÌô© ÏãúÎÇòÎ¶¨Ïò§ Îç∞Ïù¥ÌÑ∞
        const situationScenarios = [
            {
                id: 1,
                category: 'school',
                situation: 'Ïò§Îäò Ï≤¥Ïú° ÏãúÍ∞ÑÏóê Îã¨Î¶¨Í∏∞ ÏãúÌï©ÏóêÏÑú 1Îì±ÏùÑ ÌñàÏñ¥Ïöî!',
                emotions: ['Í∏∞ÏÅ®', 'ÏûêÎûëÏä§Îü¨ÏõÄ', 'Ïã†ÎÇ®', 'ÎßåÏ°±'],
                correctAnswers: ['Í∏∞ÏÅ®', 'ÏûêÎûëÏä§Îü¨ÏõÄ', 'Ïã†ÎÇ®'],
                feedback: '1Îì±ÏùÑ ÌïòÎ©¥ Ï†ïÎßê Í∏∞ÏÅòÍ≥† ÏûêÎûëÏä§ÎüΩÏ£†! Ïó¨Îü¨ Í∞êÏ†ïÏùÑ ÎèôÏãúÏóê ÎäêÎÇÑ Ïàò ÏûàÏñ¥Ïöî.'
            },
            {
                id: 2,
                category: 'school',
                situation: 'ÏàòÏóÖ ÏãúÍ∞ÑÏóê ÏÑ†ÏÉùÎãòÍªòÏÑú ÎÇ¥ Î∞úÌëúÎ•º Ïπ≠Ï∞¨Ìï¥Ï£ºÏÖ®Ïñ¥Ïöî.',
                emotions: ['ÏûêÎûëÏä§Îü¨ÏõÄ', 'Í∏∞ÏÅ®', 'Î∂ÄÎÅÑÎü¨ÏõÄ', 'Í∞êÏÇ¨'],
                correctAnswers: ['ÏûêÎûëÏä§Îü¨ÏõÄ', 'Í∏∞ÏÅ®', 'Î∂ÄÎÅÑÎü¨ÏõÄ'],
                feedback: 'Ïπ≠Ï∞¨ÏùÑ Î∞õÏúºÎ©¥ Í∏∞ÏÅòÎ©¥ÏÑúÎèÑ Î∂ÄÎÅÑÎü¨Ïö∏ Ïàò ÏûàÏñ¥Ïöî.'
            },
            {
                id: 3,
                category: 'home',
                situation: 'ÎèôÏÉùÏù¥ ÎÇ¥ Ïû•ÎÇúÍ∞êÏùÑ ÎßùÍ∞ÄÎú®Î†∏Ïñ¥Ïöî.',
                emotions: ['ÌôîÎÇ®', 'Ïä¨Ìîî', 'ÏßúÏ¶ù', 'Í∏∞ÏÅ®'],
                correctAnswers: ['ÌôîÎÇ®', 'Ïä¨Ìîî', 'ÏßúÏ¶ù'],
                feedback: 'ÏÜåÏ§ëÌïú Î¨ºÍ±¥Ïù¥ ÎßùÍ∞ÄÏßÄÎ©¥ ÌôîÍ∞Ä ÎÇòÍ≥† ÏÜçÏÉÅÌï† Ïàò ÏûàÏñ¥Ïöî.'
            },
            {
                id: 4,
                category: 'home',
                situation: 'ÏóÑÎßàÍ∞Ä ÎÇ¥Í∞Ä Ï¢ãÏïÑÌïòÎäî ÏùåÏãùÏùÑ ÎßåÎì§Ïñ¥Ï£ºÏÖ®Ïñ¥Ïöî.',
                emotions: ['Í∏∞ÏÅ®', 'Í∞êÏÇ¨', 'ÏÇ¨Îûë', 'ÌôîÎÇ®'],
                correctAnswers: ['Í∏∞ÏÅ®', 'Í∞êÏÇ¨', 'ÏÇ¨Îûë'],
                feedback: 'Ï¢ãÏïÑÌïòÎäî ÏùåÏãùÏùÑ Î®πÏúºÎ©¥ Ï†ïÎßê ÌñâÎ≥µÌïòÏ£†!'
            },
            {
                id: 5,
                category: 'friend',
                situation: 'ÏπúÌïú ÏπúÍµ¨Í∞Ä Îã§Î•∏ ÌïôÍµêÎ°ú Ï†ÑÌïôÏùÑ Í∞ÄÍ≤å ÎêòÏóàÏñ¥Ïöî.',
                emotions: ['Ïä¨Ìîî', 'Í∑∏Î¶¨ÏõÄ', 'Ïô∏Î°úÏõÄ', 'Í∏∞ÏÅ®'],
                correctAnswers: ['Ïä¨Ìîî', 'Í∑∏Î¶¨ÏõÄ', 'Ïô∏Î°úÏõÄ'],
                feedback: 'ÏπúÍµ¨ÏôÄ Ìó§Ïñ¥ÏßÄÎäî Í≤ÉÏùÄ Ï†ïÎßê Ïä¨Ìîà ÏùºÏù¥ÏóêÏöî.'
            },
            {
                id: 6,
                category: 'friend',
                situation: 'ÏπúÍµ¨Í∞Ä ÎÇ¥ ÏÉùÏùºÏóê ÍπúÏßù ÏÑ†Î¨ºÏùÑ Ï§ÄÎπÑÌñàÏñ¥Ïöî.',
                emotions: ['ÎÜÄÎûå', 'Í∏∞ÏÅ®', 'Í∞êÏÇ¨', 'ÌôîÎÇ®'],
                correctAnswers: ['ÎÜÄÎûå', 'Í∏∞ÏÅ®', 'Í∞êÏÇ¨'],
                feedback: 'ÍπúÏßù ÏÑ†Î¨ºÏùÄ ÎÜÄÎûçÍ≥† Í∏∞ÏÅú ÏùºÏù¥ÏóêÏöî!'
            }
        ];

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let userProfile = null;
        let collectedCards = JSON.parse(localStorage.getItem('collectedEmotionCards') || '[]');
        let customCards = JSON.parse(localStorage.getItem('customEmotionCards') || '[]');
        let totalPoints = parseInt(localStorage.getItem('emotionCardPoints') || '0');
        let activityTimeline = JSON.parse(localStorage.getItem('emotionActivityTimeline') || '[]');
        let currentCategory = 'all';
        let selectedCustomEmoji = '‚ùì';
        let selectedCustomColor = '#A29BFE';
        let selectedAvatar = 'ü¶Å';
        let currentGame = null;
        let bingoBoard = null;

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            initializeUser();
            renderGallery();
            updateStats();
            updatePointsDisplay();
        });

        // ÏÇ¨Ïö©Ïûê Ï¥àÍ∏∞Ìôî
        function initializeUser() {
            const savedProfile = localStorage.getItem('emotionCardUserProfile');
            if (savedProfile) {
                userProfile = JSON.parse(savedProfile);
                displayUserProfile();
            } else {
                document.getElementById('profileModal').classList.remove('hidden');
            }
        }

        // ÌîÑÎ°úÌïÑ ÌëúÏãú
        function displayUserProfile() {
            if (userProfile) {
                document.getElementById('userProfile').classList.remove('hidden');
                document.getElementById('userName').textContent = userProfile.name || 'ÌïôÏÉù';
                document.getElementById('userAvatar').textContent = userProfile.avatar || 'ü¶Å';
            }
        }

        // ÏïÑÎ∞îÌÉÄ ÏÑ†ÌÉù
        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.querySelectorAll('.avatar-selector').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // ÌîÑÎ°úÌïÑ Ï†ÄÏû•
        function saveProfile() {
            const name = document.getElementById('profileNameInput').value.trim();
            const className = document.getElementById('profileClassInput').value.trim();
            
            if (!name) {
                alert('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            userProfile = {
                name: name,
                className: className || '',
                avatar: selectedAvatar,
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('emotionCardUserProfile', JSON.stringify(userProfile));
            document.getElementById('profileModal').classList.add('hidden');
            displayUserProfile();
            
            // ÌôúÎèô Í∏∞Î°ù
            addActivity('profile_created', { name: name });
        }

        // ÌîÑÎ°úÌïÑ Î≥ÄÍ≤Ω
        function changeProfile() {
            const savedProfile = localStorage.getItem('emotionCardUserProfile');
            if (savedProfile) {
                const profile = JSON.parse(savedProfile);
                document.getElementById('profileNameInput').value = profile.name || '';
                document.getElementById('profileClassInput').value = profile.className || '';
                selectedAvatar = profile.avatar || 'ü¶Å';
            }
            document.getElementById('profileModal').classList.remove('hidden');
        }

        // ÌôúÎèô Í∏∞Î°ù Ï∂îÍ∞Ä
        function addActivity(type, data = {}) {
            const activity = {
                type: type,
                data: data,
                timestamp: new Date().toISOString()
            };
            
            // Ïò§Îäò ÎÇ†Ïßú Ï∞æÍ∏∞
            const today = new Date().toISOString().split('T')[0];
            let todayTimeline = activityTimeline.find(t => t.date === today);
            
            if (!todayTimeline) {
                todayTimeline = { date: today, activities: [] };
                activityTimeline.push(todayTimeline);
            }
            
            todayTimeline.activities.push(activity);
            localStorage.setItem('emotionActivityTimeline', JSON.stringify(activityTimeline));
        }

        // ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportLearningData() {
            const data = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                profile: userProfile || { name: 'ÏùµÎ™Ö', avatar: 'ü¶Å' },
                statistics: {
                    totalPoints: totalPoints,
                    totalCards: emotionCards.length,
                    collectedCards: collectedCards.length,
                    customCards: customCards.length,
                    completionRate: Math.round((collectedCards.length / emotionCards.length) * 100),
                    favoriteCategory: getFavoriteCategory()
                },
                timeline: activityTimeline,
                collections: {
                    collectedCards: collectedCards,
                    customCards: customCards
                },
                achievements: getAchievements()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const fileName = `Í∞êÏ†ïÏπ¥Îìú_ÌïôÏäµÍ∏∞Î°ù_${data.profile.name}_${new Date().toISOString().split('T')[0]}.json`;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            
            showModal('üì•', 'Îã§Ïö¥Î°úÎìú ÏôÑÎ£å!', 'ÌïôÏäµ Í∏∞Î°ùÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
        }

        // ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        function importLearningData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.version && data.collections) {
                        // Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
                        if (data.profile) {
                            userProfile = data.profile;
                            localStorage.setItem('emotionCardUserProfile', JSON.stringify(userProfile));
                            displayUserProfile();
                        }
                        
                        if (data.collections.collectedCards) {
                            collectedCards = data.collections.collectedCards;
                            localStorage.setItem('collectedEmotionCards', JSON.stringify(collectedCards));
                        }
                        
                        if (data.collections.customCards) {
                            customCards = data.collections.customCards;
                            localStorage.setItem('customEmotionCards', JSON.stringify(customCards));
                        }
                        
                        if (data.statistics && data.statistics.totalPoints) {
                            totalPoints = data.statistics.totalPoints;
                            localStorage.setItem('emotionCardPoints', totalPoints);
                        }
                        
                        if (data.timeline) {
                            activityTimeline = data.timeline;
                            localStorage.setItem('emotionActivityTimeline', JSON.stringify(activityTimeline));
                        }
                        
                        renderGallery();
                        updateStats();
                        updatePointsDisplay();
                        
                        showModal('‚úÖ', 'Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å!', 'ÌïôÏäµ Í∏∞Î°ùÏùÑ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                    } else {
                        alert('Ïò¨Î∞îÎ•∏ ÌïôÏäµ Í∏∞Î°ù ÌååÏùºÏù¥ ÏïÑÎãôÎãàÎã§.');
                    }
                } catch (error) {
                    alert('ÌååÏùºÏùÑ ÏùΩÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }

        // Í∞úÏÑ†Îêú ÏãúÍ∞ÅÏ†Å Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ìï®Ïàò
        function generateVisualReport() {
            const canvas = document.createElement('canvas');
            canvas.width = 1200;
            canvas.height = 1600;
            const ctx = canvas.getContext('2d');
            
            // 1. Î∞∞Í≤ΩÏùÑ Ìù∞ÏÉâÏúºÎ°ú ÏÑ§Ï†ï (Í∞ÄÎèÖÏÑ± Ìñ•ÏÉÅ)
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 2. ÏÉÅÎã® Ìó§Îçî Î∞∞Í≤Ω
            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, 300);
            
            // 3. Ï†úÎ™© (ÏãúÏä§ÌÖú Ìè∞Ìä∏ ÏÇ¨Ïö©)
            ctx.font = 'bold 48px Arial, sans-serif';
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.fillText('üåà ÎÇòÏùò Í∞êÏ†ï Ïπ¥Îìú ÌïôÏäµ Î¶¨Ìè¨Ìä∏', 600, 100);
            
            // 4. ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥
            const userName = userProfile ? userProfile.name : 'ÏùµÎ™Ö';
            const userAvatar = userProfile ? userProfile.avatar : 'ü¶Å';
            const userClass = userProfile ? userProfile.className : '';
            
            ctx.font = '36px Arial, sans-serif';
            ctx.fillText(`${userAvatar} ${userName}`, 600, 180);
            
            if (userClass) {
                ctx.font = '24px Arial, sans-serif';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.fillText(userClass, 600, 230);
            }
            
            // 5. ÎÇ†Ïßú
            ctx.font = '20px Arial, sans-serif';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillText(new Date().toLocaleDateString('ko-KR'), 600, 270);
            
            // 6. Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(50, 350, 1100, 1200);
            
            // 7. ÌÜµÍ≥Ñ Ï†úÎ™©
            ctx.font = 'bold 36px Arial, sans-serif';
            ctx.fillStyle = '#333333';
            ctx.textAlign = 'left';
            ctx.fillText('üìä ÌïôÏäµ ÌÜµÍ≥Ñ', 100, 420);
            
            // 8. ÌÜµÍ≥Ñ Ïπ¥ÎìúÎì§
            const stats = [
                { 
                    label: 'ÏàòÏßëÌïú Ïπ¥Îìú', 
                    value: collectedCards.length + 'Í∞ú', 
                    icon: 'üìö', 
                    color: '#9333ea',
                    x: 100,
                    y: 460
                },
                { 
                    label: 'ÌöçÎìù Ìè¨Ïù∏Ìä∏', 
                    value: totalPoints + 'Ï†ê', 
                    icon: 'üèÜ', 
                    color: '#3b82f6',
                    x: 400,
                    y: 460
                },
                { 
                    label: 'ÎßåÎì† Ïπ¥Îìú', 
                    value: customCards.length + 'Í∞ú', 
                    icon: '‚ú®', 
                    color: '#f59e0b',
                    x: 700,
                    y: 460
                },
                { 
                    label: 'ÏôÑÏÑ±ÎèÑ', 
                    value: Math.round((collectedCards.length / emotionCards.length) * 100) + '%', 
                    icon: 'üéØ', 
                    color: '#10b981',
                    x: 1000,
                    y: 460
                }
            ];
            
            // ÌÜµÍ≥Ñ Î∞ïÏä§ Í∑∏Î¶¨Í∏∞
            stats.forEach(stat => {
                // Î∞∞Í≤Ω Î∞ïÏä§
                ctx.fillStyle = stat.color;
                ctx.fillRect(stat.x - 50, stat.y, 250, 150);
                
                // Ìù∞ÏÉâ ÎÇ¥Î∂Ä Î∞ïÏä§
                ctx.fillStyle = 'white';
                ctx.fillRect(stat.x - 45, stat.y + 5, 240, 140);
                
                // ÏïÑÏù¥ÏΩò
                ctx.font = '48px Arial';
                ctx.fillStyle = stat.color;
                ctx.textAlign = 'center';
                ctx.fillText(stat.icon, stat.x + 75, stat.y + 60);
                
                // Í∞í
                ctx.font = 'bold 32px Arial, sans-serif';
                ctx.fillStyle = '#333333';
                ctx.fillText(stat.value, stat.x + 75, stat.y + 105);
                
                // ÎùºÎ≤®
                ctx.font = '18px Arial, sans-serif';
                ctx.fillStyle = '#666666';
                ctx.fillText(stat.label, stat.x + 75, stat.y + 135);
            });
            
            // 9. ÏàòÏßëÌïú Ïπ¥Îìú ÏÑπÏÖò
            ctx.font = 'bold 32px Arial, sans-serif';
            ctx.fillStyle = '#333333';
            ctx.textAlign = 'left';
            ctx.fillText('üìÇ ÏàòÏßëÌïú Í∞êÏ†ï Ïπ¥Îìú', 100, 700);
            
            // 10. Ïπ¥Îìú ÎØ∏Îãà Í∞§Îü¨Î¶¨
            let cardX = 100;
            let cardY = 750;
            const maxCards = Math.min(collectedCards.length, 15);
            
            if (maxCards === 0) {
                ctx.font = '24px Arial, sans-serif';
                ctx.fillStyle = '#999999';
                ctx.textAlign = 'center';
                ctx.fillText('ÏïÑÏßÅ ÏàòÏßëÌïú Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§', 600, 850);
            } else {
                for (let i = 0; i < maxCards; i++) {
                    const cardId = collectedCards[i];
                    const card = emotionCards.find(c => c.id === cardId);
                    
                    if (card) {
                        // Ïπ¥Îìú Î∞∞Í≤Ω
                        ctx.fillStyle = card.color || '#e5e7eb';
                        ctx.fillRect(cardX, cardY, 100, 100);
                        
                        // Ïπ¥Îìú ÌÖåÎëêÎ¶¨
                        ctx.strokeStyle = '#ffffff';
                        ctx.lineWidth = 3;
                        ctx.strokeRect(cardX, cardY, 100, 100);
                        
                        // Ïù¥Î™®ÏßÄ
                        ctx.font = '40px Arial';
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.fillText(card.emoji, cardX + 50, cardY + 50);
                        
                        // Ïπ¥Îìú Ïù¥Î¶Ñ
                        ctx.font = 'bold 14px Arial, sans-serif';
                        ctx.fillText(card.name, cardX + 50, cardY + 80);
                        
                        cardX += 110;
                        if ((i + 1) % 9 === 0) {
                            cardX = 100;
                            cardY += 110;
                        }
                    }
                }
            }
            
            // 11. ÏóÖÏ†Å ÏÑπÏÖò
            ctx.font = 'bold 32px Arial, sans-serif';
            ctx.fillStyle = '#333333';
            ctx.textAlign = 'left';
            ctx.fillText('üèÖ Îã¨ÏÑ±Ìïú ÏóÖÏ†Å', 100, 1100);
            
            const achievements = getAchievements();
            let achievementY = 1150;
            
            if (achievements.length === 0) {
                ctx.font = '24px Arial, sans-serif';
                ctx.fillStyle = '#999999';
                ctx.textAlign = 'center';
                ctx.fillText('ÏóÖÏ†ÅÏùÑ Îã¨ÏÑ±ÌïòÎ†§Î©¥ Îçî ÎßéÏùÄ Ïπ¥ÎìúÎ•º ÏàòÏßëÌï¥Î≥¥ÏÑ∏Ïöî!', 600, achievementY);
            } else {
                achievements.forEach((achievement, index) => {
                    ctx.font = '24px Arial, sans-serif';
                    ctx.fillStyle = '#666666';
                    ctx.textAlign = 'left';
                    ctx.fillText(`${achievement.icon} ${achievement.name}`, 100 + (index % 2) * 500, achievementY);
                    
                    if (index % 2 === 1) {
                        achievementY += 40;
                    }
                });
            }
            
            // 12. ÌïòÎã® Ï†ïÎ≥¥
            ctx.fillStyle = '#e5e7eb';
            ctx.fillRect(0, 1450, canvas.width, 150);
            
            ctx.font = '20px Arial, sans-serif';
            ctx.fillStyle = '#666666';
            ctx.textAlign = 'center';
            ctx.fillText('ÏÉùÏÑ±Ïùº: ' + new Date().toLocaleDateString('ko-KR'), 600, 1500);
            ctx.fillText('Family Heart Bridge Project', 600, 1530);
            ctx.font = '16px Arial, sans-serif';
            ctx.fillText('¬© 2025 ÎîîÏßÄÌÑ∏ Í∞êÏ†ï Ïπ¥Îìú ÌïôÏäµ ÏãúÏä§ÌÖú', 600, 1560);
            
            // 13. Ïù¥ÎØ∏ÏßÄÎ°ú Î≥ÄÌôò Î∞è Îã§Ïö¥Î°úÎìú
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const fileName = `Í∞êÏ†ïÏπ¥Îìú_Î¶¨Ìè¨Ìä∏_${userName}_${new Date().toISOString().split('T')[0]}.png`;
                a.download = fileName;
                a.click();
                URL.revokeObjectURL(url);
                
                showModal('üñºÔ∏è', 'Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± ÏôÑÎ£å!', 'Ïù¥ÎØ∏ÏßÄÍ∞Ä Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.');
            }, 'image/png');
        }

        // Ï¶êÍ≤®Ï∞æÎäî Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∞æÍ∏∞
        function getFavoriteCategory() {
            const categoryCount = {};
            collectedCards.forEach(cardId => {
                const card = emotionCards.find(c => c.id === cardId);
                if (card) {
                    categoryCount[card.category] = (categoryCount[card.category] || 0) + 1;
                }
            });
            
            let maxCategory = 'happy';
            let maxCount = 0;
            for (const [category, count] of Object.entries(categoryCount)) {
                if (count > maxCount) {
                    maxCount = count;
                    maxCategory = category;
                }
            }
            return maxCategory;
        }

        // ÏóÖÏ†Å Í≥ÑÏÇ∞
        function getAchievements() {
            const achievements = [];
            
            if (collectedCards.length >= 1) {
                achievements.push({ id: 'first_card', name: 'Ï≤´ Ïπ¥Îìú ÏàòÏßë', icon: 'üéØ' });
            }
            if (collectedCards.length >= 10) {
                achievements.push({ id: 'collector_10', name: '10Í∞ú Ïπ¥Îìú ÏàòÏßë', icon: 'üìö' });
            }
            if (collectedCards.length >= 20) {
                achievements.push({ id: 'collector_20', name: '20Í∞ú Ïπ¥Îìú ÏàòÏßë', icon: 'üèÜ' });
            }
            if (collectedCards.length === emotionCards.length) {
                achievements.push({ id: 'complete', name: 'Î™®Îì† Ïπ¥Îìú ÏàòÏßë', icon: 'üëë' });
            }
            if (customCards.length >= 1) {
                achievements.push({ id: 'creator', name: 'Ïπ¥Îìú Ï†úÏûëÏûê', icon: '‚ú®' });
            }
            if (totalPoints >= 100) {
                achievements.push({ id: 'points_100', name: '100Ï†ê Îã¨ÏÑ±', icon: 'üíØ' });
            }
            
            return achievements;
        }

        // Îç∞Ïù¥ÌÑ∞ Î©îÎâ¥ ÌëúÏãú
        function showDataMenu() {
            document.getElementById('dataMenuModal').classList.remove('hidden');
        }

        // Îç∞Ïù¥ÌÑ∞ Î©îÎâ¥ Îã´Í∏∞
        function closeDataMenu() {
            document.getElementById('dataMenuModal').classList.add('hidden');
        }

        // Ìè¨Ïù∏Ìä∏ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updatePointsDisplay() {
            document.getElementById('totalPoints').textContent = totalPoints;
        }

        // ÌÉ≠ Ï†ÑÌôò
        function showTab(tab) {
            // Î™®Îì† ÌÉ≠ Ïª®ÌÖêÏ∏† Ïà®Í∏∞Í∏∞
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Î™®Îì† ÌÉ≠ Î≤ÑÌäº Ïä§ÌÉÄÏùº Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('hover:bg-purple-100');
            });
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌëúÏãú
            document.getElementById(tab + 'Content').classList.remove('hidden');
            document.getElementById(tab + 'Tab').classList.add('bg-purple-500', 'text-white');
            document.getElementById(tab + 'Tab').classList.remove('hover:bg-purple-100');
            
            // ÌÉ≠Î≥Ñ Ï¥àÍ∏∞Ìôî
            if (tab === 'collection') {
                renderCollection();
            }
        }

        // Í∞§Îü¨Î¶¨ Î†åÎçîÎßÅ
        function renderGallery() {
            const grid = document.getElementById('emotionCardsGrid');
            const filteredCards = currentCategory === 'all' 
                ? emotionCards 
                : emotionCards.filter(card => card.category === currentCategory);
            
            grid.innerHTML = filteredCards.map(card => {
                const isCollected = collectedCards.includes(card.id);
                return `
                    <div class="emotion-card" onclick="flipCard(this, ${card.id})">
                        <div class="emotion-card-inner">
                            <div class="emotion-card-front" style="background: linear-gradient(135deg, ${card.color} 0%, ${card.color}dd 100%)">
                                <div class="text-5xl mb-3">${card.emoji}</div>
                                <h3 class="text-xl font-bold">${card.name}</h3>
                                ${isCollected ? '<span class="badge badge-collected mt-2">ÏàòÏßëÏôÑÎ£å</span>' : '<span class="badge badge-new mt-2">NEW</span>'}
                            </div>
                            <div class="emotion-card-back">
                                <h3 class="text-xl font-bold mb-3 text-gray-800">${card.name}</h3>
                                <p class="text-sm mb-3 text-gray-600">${card.desc}</p>
                                <p class="text-sm text-gray-500">
                                    <strong>ÏòàÏãú:</strong> ${card.example}
                                </p>
                                ${!isCollected ? '<button onclick="collectCard(event, ' + card.id + ')" class="mt-3 px-4 py-2 bg-purple-500 text-white rounded-full text-sm hover:bg-purple-600">ÏàòÏßëÌïòÍ∏∞</button>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ïπ¥Îìú Îí§ÏßëÍ∏∞
        function flipCard(element, cardId) {
            element.classList.toggle('flipped');
        }

        // Ïπ¥Îìú ÏàòÏßë
        function collectCard(event, cardId) {
            event.stopPropagation();
            
            if (!collectedCards.includes(cardId)) {
                collectedCards.push(cardId);
                localStorage.setItem('collectedEmotionCards', JSON.stringify(collectedCards));
                
                // Ìè¨Ïù∏Ìä∏ Ï∂îÍ∞Ä
                totalPoints += 10;
                localStorage.setItem('emotionCardPoints', totalPoints);
                updatePointsDisplay();
                
                // ÌôúÎèô Í∏∞Î°ù
                const card = emotionCards.find(c => c.id === cardId);
                addActivity('card_collected', { cardId: cardId, cardName: card.name });
                
                // Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º
                const cardElement = event.target.closest('.emotion-card');
                cardElement.classList.add('card-collected');
                
                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                showModal('üéâ', 'Ïπ¥Îìú ÏàòÏßë ÏôÑÎ£å!', 'ÏÉàÎ°úÏö¥ Í∞êÏ†ï Ïπ¥ÎìúÎ•º ÏàòÏßëÌñàÏñ¥Ïöî! +10Ï†ê');
                createConfetti();
                
                // Í∞§Îü¨Î¶¨ ÏóÖÎç∞Ïù¥Ìä∏
                setTimeout(() => {
                    renderGallery();
                    updateStats();
                }, 1000);
            }
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞
        function filterCategory(category) {
            currentCategory = category;
            renderGallery();
            
            // Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-white', 'ring-opacity-50');
            });
            event.target.classList.add('ring-4', 'ring-white', 'ring-opacity-50');
        }

        // Í≤åÏûÑ ÏãúÏûë
        function startGame(gameType) {
            const gameArea = document.getElementById('gameArea');
            gameArea.classList.remove('hidden');
            
            if (gameType === 'situation') {
                startSituationGame();
            } else if (gameType === 'detective') {
                startDetectiveGame();
            } else if (gameType === 'bingo') {
                startBingoGame();
            } else if (gameType === 'memory') {
                startMemoryGame();
            }
            
            // ÌôúÎèô Í∏∞Î°ù
            addActivity('game_started', { gameType: gameType });
        }

        // ÏÉÅÌô©-Í∞êÏ†ï Îß§Ïπ≠ Í≤åÏûÑ
        function startSituationGame() {
            const gameArea = document.getElementById('gameArea');
            let currentScenario = 0;
            let score = 0;
            let selectedEmotions = [];
            
            function showScenario() {
                const scenario = situationScenarios[currentScenario];
                selectedEmotions = [];
                
                gameArea.innerHTML = `
                    <h3 class="text-xl font-bold mb-4 text-gray-800">üìñ ÏÉÅÌô©ÏùÑ Î≥¥Í≥† Í∞êÏ†ïÏùÑ ÏÑ†ÌÉùÌï¥Ïöî! (${currentScenario + 1}/${situationScenarios.length})</h3>
                    
                    <!-- ÏÉÅÌô© Ïπ¥Îìú -->
                    <div class="situation-card mb-6">
                        <div class="text-6xl mb-4">
                            ${scenario.category === 'school' ? 'üè´' : scenario.category === 'home' ? 'üè†' : 'üë´'}
                        </div>
                        <p class="text-xl font-medium">${scenario.situation}</p>
                    </div>
                    
                    <!-- Í∞êÏ†ï ÏÑ†ÌÉù ÏòÅÏó≠ -->
                    <div class="mb-4">
                        <p class="text-center text-gray-600 mb-3">Ïó¨Îü¨ Í∞úÏùò Í∞êÏ†ïÏùÑ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏñ¥Ïöî!</p>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            ${scenario.emotions.map(emotion => {
                                const card = emotionCards.find(c => c.name === emotion);
                                return `
                                    <div class="emotion-choice-card" onclick="selectEmotion('${emotion}', this)">
                                        <div class="text-5xl text-center mb-2">${card ? card.emoji : '‚ùì'}</div>
                                        <div class="text-lg font-bold text-center">${emotion}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- Ï†úÏ∂ú Î≤ÑÌäº -->
                    <div class="text-center">
                        <button onclick="checkSituationAnswer()" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-full hover:scale-105 transition">
                            ÌôïÏù∏ÌïòÍ∏∞
                        </button>
                        <button onclick="showHint()" class="ml-3 px-6 py-3 bg-gradient-to-r from-yellow-400 to-orange-400 text-white font-bold rounded-full hover:scale-105 transition">
                            üí° ÌûåÌä∏
                        </button>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <span class="text-gray-600">Ï†êÏàò: ${score}Ï†ê</span>
                    </div>
                `;
            }
            
            window.selectEmotion = function(emotion, element) {
                element.classList.toggle('selected');
                const index = selectedEmotions.indexOf(emotion);
                if (index > -1) {
                    selectedEmotions.splice(index, 1);
                } else {
                    selectedEmotions.push(emotion);
                }
            };
            
            window.showHint = function() {
                const scenario = situationScenarios[currentScenario];
                showModal('üí°', 'ÌûåÌä∏', `Ïù¥Îü∞ ÏÉÅÌô©ÏóêÏÑúÎäî Î≥¥ÌÜµ ${scenario.correctAnswers[0]}ÏùÑ(Î•º) ÎäêÍª¥Ïöî!`);
            };
            
            window.checkSituationAnswer = function() {
                const scenario = situationScenarios[currentScenario];
                let correct = 0;
                
                selectedEmotions.forEach(emotion => {
                    if (scenario.correctAnswers.includes(emotion)) {
                        correct++;
                    }
                });
                
                const points = correct * 10;
                score += points;
                
                if (correct > 0) {
                    showModal('‚úÖ', 'ÏûòÌñàÏñ¥Ïöî!', `${scenario.feedback} +${points}Ï†ê`);
                } else {
                    showModal('üí≠', 'Îã§Ïãú ÏÉùÍ∞ÅÌï¥Î¥êÏöî', scenario.feedback);
                }
                
                currentScenario++;
                if (currentScenario < situationScenarios.length) {
                    setTimeout(showScenario, 2500);
                } else {
                    totalPoints += score;
                    localStorage.setItem('emotionCardPoints', totalPoints);
                    updatePointsDisplay();
                    addActivity('game_completed', { gameType: 'situation', score: score });
                    showModal('üéä', 'Í≤åÏûÑ ÏôÑÎ£å!', `Ï¥ù ${score}Ï†êÏùÑ ÌöçÎìùÌñàÏñ¥Ïöî!`);
                    setTimeout(() => {
                        gameArea.classList.add('hidden');
                    }, 3000);
                }
            };
            
            showScenario();
        }

        // Í∞êÏ†ï ÌÉêÏ†ï Í≤åÏûÑ
        function startDetectiveGame() {
            const gameArea = document.getElementById('gameArea');
            
            const detectiveCases = [
                {
                    clues: [
                        'ÏñºÍµ¥Ïù¥ Îπ®Í∞úÏ°åÏñ¥Ïöî',
                        'Í≥†Í∞úÎ•º ÏàôÏòÄÏñ¥Ïöî',
                        'Î™©ÏÜåÎ¶¨Í∞Ä ÏûëÏïÑÏ°åÏñ¥Ïöî'
                    ],
                    emotions: ['Î∂ÄÎÅÑÎü¨ÏõÄ', 'Í∏∞ÏÅ®', 'ÌôîÎÇ®', 'Ïä¨Ìîî'],
                    answer: 'Î∂ÄÎÅÑÎü¨ÏõÄ',
                    explanation: 'ÏñºÍµ¥Ïù¥ Îπ®Í∞úÏßÄÍ≥† Í≥†Í∞úÎ•º ÏàôÏù¥Îäî Í≤ÉÏùÄ Î∂ÄÎÅÑÎü¨Ïö∏ ÎïåÏùò Î™®ÏäµÏù¥ÏóêÏöî.'
                },
                {
                    clues: [
                        'ÎààÎ¨ºÏù¥ ÎÇòÏöî',
                        'ÏûÖÏà†Ïù¥ Îñ®Î†§Ïöî',
                        'ÌòºÏûê ÏûàÍ≥† Ïã∂Ïñ¥Ïöî'
                    ],
                    emotions: ['Ïä¨Ìîî', 'Í∏∞ÏÅ®', 'ÎÜÄÎûå', 'Ïã†ÎÇ®'],
                    answer: 'Ïä¨Ìîî',
                    explanation: 'ÎààÎ¨ºÏù¥ ÎÇòÍ≥† ÌòºÏûê ÏûàÍ≥† Ïã∂ÏùÑ ÎïåÎäî Ïä¨Ìîà Í∞êÏ†ïÏùÑ ÎäêÎÅºÍ≥† ÏûàÏñ¥Ïöî.'
                },
                {
                    clues: [
                        'Ï£ºÎ®πÏùÑ ÍΩâ Ï•êÏóàÏñ¥Ïöî',
                        'ÏñºÍµ¥Ïù¥ Î∂âÏñ¥Ï°åÏñ¥Ïöî',
                        'ÌÅ∞ ÏÜåÎ¶¨Í∞Ä ÎÇòÏöî'
                    ],
                    emotions: ['ÌôîÎÇ®', 'Í∏∞ÏÅ®', 'ÎëêÎ†§ÏõÄ', 'Í∞êÏÇ¨'],
                    answer: 'ÌôîÎÇ®',
                    explanation: 'Ï£ºÎ®πÏùÑ Ï•êÍ≥† ÌÅ∞ ÏÜåÎ¶¨Î•º ÎÇ¥Îäî Í≤ÉÏùÄ ÌôîÍ∞Ä ÎÇ¨ÏùÑ ÎïåÏùò ÌëúÌòÑÏù¥ÏóêÏöî.'
                }
            ];
            
            let currentCase = 0;
            let score = 0;
            
            function showCase() {
                const detectiveCase = detectiveCases[currentCase];
                
                gameArea.innerHTML = `
                    <h3 class="text-xl font-bold mb-4 text-gray-800">üîç Í∞êÏ†ï ÌÉêÏ†ï: Îã®ÏÑúÎ•º Î≥¥Í≥† Í∞êÏ†ïÏùÑ Ï∂îÎ¶¨Ìï¥Ïöî!</h3>
                    
                    <div class="bg-white rounded-2xl p-6 mb-6">
                        <h4 class="font-bold text-lg mb-4">üìã Îã®ÏÑúÎì§:</h4>
                        <ul class="space-y-2">
                            ${detectiveCase.clues.map(clue => `
                                <li class="flex items-center">
                                    <span class="text-2xl mr-3">üîç</span>
                                    <span class="text-lg">${clue}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        ${detectiveCase.emotions.map(emotion => {
                            const card = emotionCards.find(c => c.name === emotion);
                            return `
                                <button onclick="checkDetectiveAnswer('${emotion}')" 
                                    class="game-card bg-white p-6 rounded-xl hover:bg-purple-100">
                                    <div class="text-5xl mb-2">${card ? card.emoji : '‚ùì'}</div>
                                    <div class="font-bold text-lg">${emotion}</div>
                                </button>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="text-center">
                        <span class="text-gray-600">ÏÇ¨Í±¥ ${currentCase + 1}/${detectiveCases.length} | Ï†êÏàò: ${score}Ï†ê</span>
                    </div>
                `;
            }
            
            window.checkDetectiveAnswer = function(emotion) {
                const detectiveCase = detectiveCases[currentCase];
                
                if (emotion === detectiveCase.answer) {
                    score += 20;
                    showModal('üéØ', 'Ï†ïÎãµ!', `${detectiveCase.explanation} +20Ï†ê`);
                } else {
                    showModal('ü§î', 'Îã§Ïãú ÏÉùÍ∞ÅÌï¥Î¥êÏöî', `ÌûåÌä∏: ${detectiveCase.clues[0]}`);
                }
                
                currentCase++;
                if (currentCase < detectiveCases.length) {
                    setTimeout(showCase, 2500);
                } else {
                    totalPoints += score;
                    localStorage.setItem('emotionCardPoints', totalPoints);
                    updatePointsDisplay();
                    addActivity('game_completed', { gameType: 'detective', score: score });
                    showModal('üèÜ', 'ÌÉêÏ†ï ÏûÑÎ¨¥ ÏôÑÎ£å!', `Ï¥ù ${score}Ï†êÏùÑ ÌöçÎìùÌñàÏñ¥Ïöî!`);
                    setTimeout(() => {
                        gameArea.classList.add('hidden');
                    }, 3000);
                }
            };
            
            showCase();
        }

        // Í∞êÏ†ï ÎπôÍ≥† Í≤åÏûÑ
        function startBingoGame() {
            const gameArea = document.getElementById('gameArea');
            
            // ÎπôÍ≥†Ìåê ÏÉùÏÑ±
            const bingoEmotions = [
                'Í∏∞ÏÅ®', 'Ïä¨Ìîî', 'ÌôîÎÇ®', 'ÎÜÄÎûå', 
                'Í∞êÏÇ¨', 'Î¨¥Î£å', 'ÏÑ§Î†ò', 'Í±±Ï†ï',
                'ÏûêÎûëÏä§Îü¨ÏõÄ', 'Î∂ÄÎÅÑÎü¨ÏõÄ', 'Ïã†ÎÇ®', 'ÎëêÎ†§ÏõÄ'
            ];
            
            // 3x3 ÎπôÍ≥†Ìåê ÏÉùÏÑ± (Ï§ëÏïôÏùÄ FREE)
            bingoBoard = [
                [...bingoEmotions.slice(0, 4)],
                [bingoEmotions[4], 'FREE', bingoEmotions[5]],
                [...bingoEmotions.slice(6, 9)]
            ];
            
            let checkedCells = [[false, false, false], [false, true, false], [false, false, false]];
            
            gameArea.innerHTML = `
                <h3 class="text-xl font-bold mb-4 text-gray-800">üéØ Ïò§Îäò ÎäêÎÇÄ Í∞êÏ†ïÏúºÎ°ú ÎπôÍ≥†Î•º ÏôÑÏÑ±Ìï¥Ïöî!</h3>
                
                <div class="max-w-md mx-auto mb-6">
                    <div class="grid grid-cols-3 gap-3">
                        ${bingoBoard.map((row, i) => 
                            row.map((emotion, j) => {
                                if (emotion === 'FREE') {
                                    return `
                                        <div class="bingo-cell center">
                                            <span class="text-2xl">üåü</span>
                                            <span class="font-bold">FREE</span>
                                        </div>
                                    `;
                                }
                                const card = emotionCards.find(c => c.name === emotion);
                                return `
                                    <div class="bingo-cell" onclick="checkBingoCell(${i}, ${j}, '${emotion}')" id="bingo-${i}-${j}">
                                        <span class="text-3xl">${card ? card.emoji : '‚ùì'}</span>
                                        <span class="text-sm font-bold">${emotion}</span>
                                    </div>
                                `;
                            }).join('')
                        ).join('')}
                    </div>
                </div>
                
                <div class="text-center mb-4">
                    <p class="text-gray-600">Ïò§Îäò Ïã§Ï†úÎ°ú ÎäêÎÇÄ Í∞êÏ†ïÎßå Ï≤¥ÌÅ¨Ìï¥Ïöî!</p>
                </div>
                
                <div class="text-center">
                    <button onclick="checkBingo()" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-full hover:scale-105 transition">
                        ÎπôÍ≥† ÌôïÏù∏ÌïòÍ∏∞
                    </button>
                </div>
            `;
            
            window.checkBingoCell = function(i, j, emotion) {
                const cell = document.getElementById(`bingo-${i}-${j}`);
                cell.classList.toggle('checked');
                checkedCells[i][j] = !checkedCells[i][j];
                
                if (checkedCells[i][j]) {
                    showModal('üòä', emotion, `Ïò§Îäò ${emotion}ÏùÑ(Î•º) ÎäêÍºàÍµ∞Ïöî!`);
                }
            };
            
            window.checkBingo = function() {
                let bingoCount = 0;
                
                // Í∞ÄÎ°ú Ï≤¥ÌÅ¨
                for (let i = 0; i < 3; i++) {
                    if (checkedCells[i].every(cell => cell === true)) {
                        bingoCount++;
                    }
                }
                
                // ÏÑ∏Î°ú Ï≤¥ÌÅ¨
                for (let j = 0; j < 3; j++) {
                    if (checkedCells.every(row => row[j] === true)) {
                        bingoCount++;
                    }
                }
                
                // ÎåÄÍ∞ÅÏÑ† Ï≤¥ÌÅ¨
                if (checkedCells[0][0] && checkedCells[1][1] && checkedCells[2][2]) {
                    bingoCount++;
                }
                if (checkedCells[0][2] && checkedCells[1][1] && checkedCells[2][0]) {
                    bingoCount++;
                }
                
                const points = bingoCount * 30;
                if (bingoCount > 0) {
                    totalPoints += points;
                    localStorage.setItem('emotionCardPoints', totalPoints);
                    updatePointsDisplay();
                    addActivity('game_completed', { gameType: 'bingo', score: points });
                    showModal('üéâ', `${bingoCount}Ï§Ñ ÎπôÍ≥†!`, `Ï∂ïÌïòÌï¥Ïöî! ${points}Ï†êÏùÑ ÌöçÎìùÌñàÏñ¥Ïöî!`);
                    createConfetti();
                } else {
                    showModal('üí™', 'Í≥ÑÏÜç ÎèÑÏ†Ñ!', 'Îçî ÎßéÏùÄ Í∞êÏ†ïÏùÑ Ï≤¥ÌÅ¨Ìï¥ÏÑú ÎπôÍ≥†Î•º ÎßåÎì§Ïñ¥Î¥êÏöî!');
                }
            };
        }

        // Î©îÎ™®Î¶¨ Í≤åÏûÑ
        function startMemoryGame() {
            const gameArea = document.getElementById('gameArea');
            const memoryCards = emotionCards.slice(0, 6);
            const gameCards = [...memoryCards, ...memoryCards].sort(() => Math.random() - 0.5);
            
            gameArea.innerHTML = `
                <h3 class="text-xl font-bold mb-4 text-gray-800">üß© Í∞ôÏùÄ Í∞êÏ†ï Ïπ¥ÎìúÎ•º Ï∞æÏïÑÏ£ºÏÑ∏Ïöî!</h3>
                <div class="grid grid-cols-4 gap-3">
                    ${gameCards.map((card, index) => `
                        <div class="memory-card bg-purple-500 rounded-lg p-6 text-center cursor-pointer" data-id="${card.id}" data-index="${index}" onclick="flipMemoryCard(this)">
                            <div class="card-content hidden">
                                <div class="text-5xl">${card.emoji}</div>
                                <div class="text-sm font-bold text-white mt-1">${card.name}</div>
                            </div>
                            <div class="card-back text-4xl text-white">?</div>
                        </div>
                    `).join('')}
                </div>
                <div class="mt-4 text-center">
                    <span class="text-gray-600">Ï∞æÏùÄ Ïåç: <span id="pairCount">0</span>/6</span>
                </div>
            `;
            
            let flippedCards = [];
            let matchedPairs = 0;
            
            window.flipMemoryCard = function(card) {
                if (flippedCards.length < 2 && !card.classList.contains('matched')) {
                    card.querySelector('.card-content').classList.remove('hidden');
                    card.querySelector('.card-back').classList.add('hidden');
                    flippedCards.push(card);
                    
                    if (flippedCards.length === 2) {
                        if (flippedCards[0].dataset.id === flippedCards[1].dataset.id) {
                            flippedCards.forEach(c => c.classList.add('matched'));
                            matchedPairs++;
                            document.getElementById('pairCount').textContent = matchedPairs;
                            
                            if (matchedPairs === 6) {
                                totalPoints += 50;
                                localStorage.setItem('emotionCardPoints', totalPoints);
                                updatePointsDisplay();
                                addActivity('game_completed', { gameType: 'memory', score: 50 });
                                showModal('üèÜ', 'Í≤åÏûÑ ÏôÑÎ£å!', 'Î™®Îì† ÏåçÏùÑ Ï∞æÏïòÏñ¥Ïöî! +50Ï†ê');
                            }
                            
                            flippedCards = [];
                        } else {
                            setTimeout(() => {
                                flippedCards.forEach(c => {
                                    c.querySelector('.card-content').classList.add('hidden');
                                    c.querySelector('.card-back').classList.remove('hidden');
                                });
                                flippedCards = [];
                            }, 1000);
                        }
                    }
                }
            };
        }

        // Ïª§Ïä§ÌÖÄ Ïπ¥Îìú Í¥ÄÎ†® Ìï®Ïàò
        function selectEmoji(emoji) {
            selectedCustomEmoji = emoji;
            document.getElementById('selectedEmoji').textContent = emoji;
            document.getElementById('previewEmoji').textContent = emoji;
        }

        function selectColor(color) {
            selectedCustomColor = color;
            document.getElementById('previewCardFront').style.background = `linear-gradient(135deg, ${color} 0%, ${color}dd 100%)`;
        }

        // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('customEmotionName').addEventListener('input', function() {
            document.getElementById('previewName').textContent = this.value || 'Í∞êÏ†ï Ïù¥Î¶Ñ';
            document.getElementById('previewNameBack').textContent = this.value || 'Í∞êÏ†ï Ïù¥Î¶Ñ';
        });

        document.getElementById('customEmotionDesc').addEventListener('input', function() {
            document.getElementById('previewDesc').textContent = this.value || 'ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî';
        });

        document.getElementById('customEmotionExample').addEventListener('input', function() {
            document.getElementById('previewExample').textContent = 'ÏòàÏãú: ' + (this.value || '-');
        });

        // Ïª§Ïä§ÌÖÄ Ïπ¥Îìú Ï†ÄÏû•
        function saveCustomCard() {
            const name = document.getElementById('customEmotionName').value.trim();
            const desc = document.getElementById('customEmotionDesc').value.trim();
            const example = document.getElementById('customEmotionExample').value.trim();
            
            if (!name) {
                alert('Í∞êÏ†ï Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            if (!desc) {
                alert('ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            const newCard = {
                id: 'custom_' + Date.now(),
                name: name,
                emoji: selectedCustomEmoji,
                color: selectedCustomColor,
                desc: desc,
                example: example || 'ÏßÅÏ†ë Í≤ΩÌóòÌï¥Î≥¥ÏÑ∏Ïöî',
                createdAt: new Date().toISOString()
            };
            
            customCards.push(newCard);
            localStorage.setItem('customEmotionCards', JSON.stringify(customCards));
            
            // Ìè¨Ïù∏Ìä∏ Ï∂îÍ∞Ä
            totalPoints += 20;
            localStorage.setItem('emotionCardPoints', totalPoints);
            updatePointsDisplay();
            
            // ÌôúÎèô Í∏∞Î°ù
            addActivity('card_created', { cardName: name });
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            showModal('‚ú®', 'Ïπ¥Îìú ÏÉùÏÑ± ÏôÑÎ£å!', `"${name}" Ïπ¥ÎìúÎ•º ÎßåÎì§ÏóàÏñ¥Ïöî! +20Ï†ê`);
            createConfetti();
            
            // Ìèº Ï¥àÍ∏∞Ìôî
            document.getElementById('customEmotionName').value = '';
            document.getElementById('customEmotionDesc').value = '';
            document.getElementById('customEmotionExample').value = '';
            selectedCustomEmoji = '‚ùì';
            selectedCustomColor = '#A29BFE';
            document.getElementById('selectedEmoji').textContent = '‚ùì';
            document.getElementById('previewEmoji').textContent = '‚ùì';
            document.getElementById('previewName').textContent = 'Í∞êÏ†ï Ïù¥Î¶Ñ';
            document.getElementById('previewNameBack').textContent = 'Í∞êÏ†ï Ïù¥Î¶Ñ';
            document.getElementById('previewDesc').textContent = 'ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî';
            document.getElementById('previewExample').textContent = 'ÏòàÏãú: -';
            document.getElementById('previewCardFront').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            
            updateStats();
        }

        // Ïª¨Î†âÏÖò Î†åÎçîÎßÅ
        function renderCollection() {
            // ÏàòÏßëÌïú Ïπ¥Îìú
            const collectionGrid = document.getElementById('collectionGrid');
            if (collectedCards.length > 0) {
                collectionGrid.innerHTML = collectedCards.map(cardId => {
                    const card = emotionCards.find(c => c.id === cardId);
                    return `
                        <div class="bg-white rounded-xl p-4 text-center shadow-lg">
                            <div class="text-3xl mb-2">${card.emoji}</div>
                            <div class="font-bold text-sm">${card.name}</div>
                        </div>
                    `;
                }).join('');
            } else {
                collectionGrid.innerHTML = '<p class="text-gray-500 col-span-4">ÏïÑÏßÅ ÏàòÏßëÌïú Ïπ¥ÎìúÍ∞Ä ÏóÜÏñ¥Ïöî</p>';
            }
            
            // Ïª§Ïä§ÌÖÄ Ïπ¥Îìú
            const customGrid = document.getElementById('customCardsGrid');
            if (customCards.length > 0) {
                customGrid.innerHTML = customCards.map(card => `
                    <div class="bg-white rounded-xl p-4 text-center shadow-lg" style="background: linear-gradient(135deg, ${card.color}22 0%, ${card.color}44 100%)">
                        <div class="text-3xl mb-2">${card.emoji}</div>
                        <div class="font-bold text-sm">${card.name}</div>
                    </div>
                `).join('');
            } else {
                customGrid.innerHTML = '<p class="text-gray-500 col-span-4">ÏïÑÏßÅ ÎßåÎì† Ïπ¥ÎìúÍ∞Ä ÏóÜÏñ¥Ïöî</p>';
            }
        }

        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateStats() {
            const total = emotionCards.length;
            const collected = collectedCards.length;
            const completion = Math.round((collected / total) * 100);
            
            document.getElementById('totalCards').textContent = total;
            document.getElementById('collectedCards').textContent = collected;
            document.getElementById('completionRate').textContent = completion + '%';
            document.getElementById('customCards').textContent = customCards.length;
            document.getElementById('progressText').textContent = `${collected}/${total}`;
            document.getElementById('progressBar').style.width = completion + '%';
        }

        // Î™®Îã¨ ÌëúÏãú
        function showModal(icon, title, message) {
            const modal = document.getElementById('successModal');
            const content = document.getElementById('successModalContent');
            
            document.getElementById('modalIcon').textContent = icon;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.style.transform = 'scale(1)';
            }, 100);
            
            setTimeout(() => {
                closeModal();
            }, 2000);
        }

        // Î™®Îã¨ Îã´Í∏∞
        function closeModal() {
            const modal = document.getElementById('successModal');
            const content = document.getElementById('successModalContent');
            content.style.transform = 'scale(0)';
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // ÏÉâÏ¢ÖÏù¥ Ìö®Í≥º
        function createConfetti() {
            const colors = ['#FFD93D', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }
    </script>
</body>
</html>